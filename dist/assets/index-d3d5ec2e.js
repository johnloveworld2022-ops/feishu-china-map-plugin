var oe=Object.defineProperty;var le=(s,t,n)=>t in s?oe(s,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[t]=n;var w=(s,t,n)=>(le(s,typeof t!="symbol"?t+"":t,n),n);import{r as N,a as ce,g as de,R as X}from"./vendor-57209f9c.js";import{i as ue,r as U}from"./echarts-9fe7269c.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();var K={exports:{}},O={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var he=N,me=Symbol.for("react.element"),fe=Symbol.for("react.fragment"),xe=Object.prototype.hasOwnProperty,ge=he.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,pe={key:!0,ref:!0,__self:!0,__source:!0};function Y(s,t,n){var a,r={},i=null,o=null;n!==void 0&&(i=""+n),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(o=t.ref);for(a in t)xe.call(t,a)&&!pe.hasOwnProperty(a)&&(r[a]=t[a]);if(s&&s.defaultProps)for(a in t=s.defaultProps,t)r[a]===void 0&&(r[a]=t[a]);return{$$typeof:me,type:s,key:i,ref:o,props:r,_owner:ge.current}}O.Fragment=fe;O.jsx=Y;O.jsxs=Y;K.exports=O;var e=K.exports,$={},W=ce;$.createRoot=W.createRoot,$.hydrateRoot=W.hydrateRoot;const be={type:"FeatureCollection",features:[{type:"Feature",properties:{name:"北京市",adcode:"110000"},geometry:{type:"Polygon",coordinates:[[[116.4,39.9],[116.5,39.9],[116.5,40],[116.4,40],[116.4,39.9]]]}},{type:"Feature",properties:{name:"上海市",adcode:"310000"},geometry:{type:"Polygon",coordinates:[[[121.4,31.2],[121.5,31.2],[121.5,31.3],[121.4,31.3],[121.4,31.2]]]}},{type:"Feature",properties:{name:"广东省",adcode:"440000"},geometry:{type:"Polygon",coordinates:[[[113.2,23.1],[113.3,23.1],[113.3,23.2],[113.2,23.2],[113.2,23.1]]]}},{type:"Feature",properties:{name:"浙江省",adcode:"330000"},geometry:{type:"Polygon",coordinates:[[[120.1,30.2],[120.2,30.2],[120.2,30.3],[120.1,30.3],[120.1,30.2]]]}},{type:"Feature",properties:{name:"江苏省",adcode:"320000"},geometry:{type:"Polygon",coordinates:[[[118.7,32],[118.8,32],[118.8,32.1],[118.7,32.1],[118.7,32]]]}},{type:"Feature",properties:{name:"四川省",adcode:"510000"},geometry:{type:"Polygon",coordinates:[[[104,30.6],[104.1,30.6],[104.1,30.7],[104,30.7],[104,30.6]]]}}]},H=[{id:"1",name:"上海市",regionType:"华东",manager:{id:"m1",name:"小黄",contact:"13800138001",email:"xiaohuang@example.com"},institutions:[{id:"i1",name:"上海分公司",address:"上海市浦东新区",establishedDate:new Date("2020-01-15"),status:"active",regionId:"1"},{id:"i2",name:"上海办事处",address:"上海市黄浦区",establishedDate:new Date("2021-03-20"),status:"active",regionId:"1"},{id:"i3",name:"上海研发中心",address:"上海市徐汇区",establishedDate:new Date("2022-06-10"),status:"active",regionId:"1"}]},{id:"2",name:"广东省",regionType:"华南",manager:{id:"m2",name:"小李",contact:"13800138002",email:"xiaoli@example.com"},institutions:[{id:"i4",name:"广州分公司",address:"广州市天河区",establishedDate:new Date("2019-08-12"),status:"active",regionId:"2"},{id:"i5",name:"深圳办事处",address:"深圳市南山区",establishedDate:new Date("2020-11-05"),status:"active",regionId:"2"}]},{id:"3",name:"北京市",regionType:"华北",manager:{id:"m3",name:"小王",contact:"13800138003",email:"xiaowang@example.com"},institutions:[{id:"i6",name:"北京总部",address:"北京市朝阳区",establishedDate:new Date("2018-01-01"),status:"active",regionId:"3"},{id:"i7",name:"北京研发部",address:"北京市海淀区",establishedDate:new Date("2019-05-15"),status:"active",regionId:"3"},{id:"i8",name:"北京销售部",address:"北京市西城区",establishedDate:new Date("2020-09-20"),status:"active",regionId:"3"},{id:"i9",name:"北京客服中心",address:"北京市东城区",establishedDate:new Date("2021-12-01"),status:"active",regionId:"3"}]},{id:"4",name:"浙江省",regionType:"华东",manager:{id:"m4",name:"小张",contact:"13800138004",email:"xiaozhang@example.com"},institutions:[{id:"i10",name:"杭州分公司",address:"杭州市西湖区",establishedDate:new Date("2020-04-10"),status:"active",regionId:"4"}]},{id:"5",name:"江苏省",regionType:"华东",manager:{id:"m5",name:"小刘",contact:"13800138005",email:"xiaoliu@example.com"},institutions:[{id:"i11",name:"南京分公司",address:"南京市鼓楼区",establishedDate:new Date("2021-07-15"),status:"active",regionId:"5"},{id:"i12",name:"苏州办事处",address:"苏州市工业园区",establishedDate:new Date("2022-02-28"),status:"active",regionId:"5"}]},{id:"6",name:"四川省",regionType:"华西",manager:{id:"m6",name:"小陈",contact:"13800138006",email:"xiaochen@example.com"},institutions:[{id:"i13",name:"成都分公司",address:"成都市高新区",establishedDate:new Date("2021-10-12"),status:"active",regionId:"6"}]}],ve=s=>{if(s.length===0)return[];const t=Math.max(...s.map(r=>r.value),1),n=[];n.push({min:0,max:0,color:"#f0f0f0",label:"无机构"});const a=Math.min(6,t);for(let r=1;r<=a;r++){const i=Math.ceil((r-1)*t/a)+(r===1?1:0),o=r===a?void 0:Math.ceil(r*t/a);n.push({min:i,max:o,color:ye(r),label:o?`${i}-${o}家`:`${i}家以上`})}return n},ye=s=>{const t=["#c6e48b","#7bc96f","#239a3b","#196127","#0d4d1a","#0a3d14"],n=Math.min(s-1,t.length-1);return t[n]},je=({data:s,onMapEvent:t,loading:n=!1,className:a=""})=>{const r=N.useRef(null),i=N.useRef(null);return N.useEffect(()=>r.current?(i.current=ue(r.current),(async()=>{try{const l=await(await fetch("https://geo.datav.aliyun.com/areas_v3/bound/100000_full.json")).json();U("china",l)}catch(c){console.warn("在线地图加载失败，使用本地数据:",c),U("china",be)}})(),()=>{var c;(c=i.current)==null||c.dispose()}):void 0,[]),N.useEffect(()=>{if(!i.current)return;setTimeout(()=>{var d,m,g,b,v;const c={title:{text:"中国地图仪表盘",left:"center",textStyle:{color:"#1f2329",fontSize:18,fontWeight:"bold"}},tooltip:{trigger:"item",formatter:f=>{const u=f.data;return u?`
            <div style="padding: 8px;">
              <div style="font-weight: bold; margin-bottom: 4px;">${u.name}</div>
              <div>负责人: ${u.manager}</div>
              <div>机构数量: ${u.value}</div>
              <div>管理区域: ${u.regionType}</div>
            </div>
          `:""},backgroundColor:"rgba(255, 255, 255, 0.95)",borderColor:"#e3e6ea",borderWidth:1,textStyle:{color:"#1f2329",fontSize:12}},visualMap:{type:"piecewise",pieces:ve(s),orient:"vertical",left:"left",top:"bottom",textStyle:{color:"#1f2329",fontSize:12},itemWidth:20,itemHeight:14,itemGap:5},series:[{name:"机构分布",type:"map",map:"china",data:s,roam:!0,scaleLimit:{min:.8,max:3},itemStyle:{borderColor:"#333",borderWidth:.5,areaColor:"#f0f0f0"},emphasis:{itemStyle:{areaColor:"#ffd700",shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.3)",borderWidth:1,borderColor:"#ff6b35"}},select:{itemStyle:{areaColor:"#ff6b35",borderWidth:1,borderColor:"#ff4500"}}}]};n?(d=i.current)==null||d.showLoading("default",{text:"加载中...",color:"#3370ff",textColor:"#1f2329",maskColor:"rgba(255, 255, 255, 0.8)"}):(m=i.current)==null||m.hideLoading(),(g=i.current)==null||g.setOption(c,!0);const l=f=>{f.data&&t&&t({type:"click",data:{regionId:f.data.name,regionName:f.data.name,institutionCount:f.data.value,manager:f.data.manager},timestamp:Date.now()})},h=f=>{f.data&&t&&t({type:"hover",data:{regionId:f.data.name,regionName:f.data.name,institutionCount:f.data.value,manager:f.data.manager},timestamp:Date.now()})};return(b=i.current)==null||b.on("click",l),(v=i.current)==null||v.on("mouseover",h),()=>{var f,u;(f=i.current)==null||f.off("click",l),(u=i.current)==null||u.off("mouseover",h)}},100)},[s,n,t]),N.useEffect(()=>{const o=()=>{var l;(l=i.current)==null||l.resize()},c=l=>{if(i.current)switch(l.key){case"Escape":i.current.dispatchAction({type:"restore"});break;case"+":case"=":i.current.dispatchAction({type:"geoZoom",zoom:1.2});break;case"-":i.current.dispatchAction({type:"geoZoom",zoom:.8});break;case"r":case"R":i.current.dispatchAction({type:"geoRestore"});break}};return window.addEventListener("resize",o),window.addEventListener("keydown",c),()=>{window.removeEventListener("resize",o),window.removeEventListener("keydown",c)}},[]),e.jsx("div",{ref:r,className:`w-full h-full min-h-[600px] ${a}`,style:{minHeight:"600px",width:"100%",height:"100%"}})},Ne=({regions:s,selectedRegion:t,onRegionSelect:n})=>{const[a,r]=N.useState(""),[i,o]=N.useState("all"),c=Array.from(new Set(s.map(m=>m.regionType))),h=[...s.filter(m=>{const g=m.name.toLowerCase().includes(a.toLowerCase())||m.manager.name.toLowerCase().includes(a.toLowerCase()),b=i==="all"||m.regionType===i;return g&&b})].sort((m,g)=>g.institutions.length-m.institutions.length),d=s.find(m=>m.name===t);return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-feishu-primary mb-1",children:"搜索地区"}),e.jsx("input",{type:"text",value:a,onChange:m=>r(m.target.value),placeholder:"输入省份名称或负责人姓名",className:"w-full px-3 py-2 border border-feishu-border rounded-md focus:outline-none focus:ring-2 focus:ring-feishu-accent focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-feishu-primary mb-1",children:"管理区域"}),e.jsxs("select",{value:i,onChange:m=>o(m.target.value),className:"w-full px-3 py-2 border border-feishu-border rounded-md focus:outline-none focus:ring-2 focus:ring-feishu-accent focus:border-transparent",children:[e.jsx("option",{value:"all",children:"全部区域"}),c.map(m=>e.jsx("option",{value:m,children:m},m))]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsx("div",{className:"px-4 pb-2",children:e.jsxs("h3",{className:"text-sm font-medium text-feishu-primary mb-2",children:["地区列表 (",h.length,")"]})}),e.jsx("div",{className:"space-y-1 px-4",children:h.map(m=>e.jsx("div",{onClick:()=>n(m.name===t?null:m.name),className:`p-3 rounded-md cursor-pointer transition-colors ${t===m.name?"bg-feishu-accent bg-opacity-10 border border-feishu-accent":"hover:bg-gray-50 border border-transparent"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-feishu-primary",children:m.name}),e.jsxs("div",{className:"text-sm text-feishu-secondary",children:[m.manager.name," · ",m.regionType]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-semibold text-feishu-accent",children:m.institutions.length}),e.jsx("div",{className:"text-xs text-feishu-secondary",children:"机构"})]})]})},m.id))}),h.length===0&&e.jsxs("div",{className:"text-center py-8 text-feishu-secondary",children:[e.jsx("div",{className:"text-4xl mb-2",children:"🔍"}),e.jsx("div",{children:"未找到匹配的地区"})]})]}),d&&e.jsxs("div",{className:"border-t border-feishu-border p-4 bg-white",children:[e.jsxs("h3",{className:"font-medium text-feishu-primary mb-3",children:[d.name," 详情"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-feishu-secondary",children:"负责人:"}),e.jsx("span",{className:"text-feishu-primary",children:d.manager.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-feishu-secondary",children:"联系方式:"}),e.jsx("span",{className:"text-feishu-primary",children:d.manager.contact})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-feishu-secondary",children:"管理区域:"}),e.jsx("span",{className:"text-feishu-primary",children:d.regionType})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-feishu-secondary",children:"机构总数:"}),e.jsx("span",{className:"text-feishu-accent font-semibold",children:d.institutions.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-feishu-secondary",children:"活跃机构:"}),e.jsx("span",{className:"text-feishu-success",children:d.institutions.filter(m=>m.status==="active").length})]})]}),e.jsx("button",{onClick:()=>n(null),className:"w-full mt-3 feishu-button feishu-button-secondary text-sm",children:"关闭详情"})]})]})},T={华东:{regionType:"华东",baseColor:"#3b82f6",colorRange:["#eff6ff","#dbeafe","#bfdbfe","#93c5fd","#60a5fa","#3b82f6","#2563eb","#1d4ed8","#1e40af"],maxInstitutions:20},华南:{regionType:"华南",baseColor:"#ef4444",colorRange:["#fef2f2","#fee2e2","#fecaca","#fca5a5","#f87171","#ef4444","#dc2626","#b91c1c","#991b1b"],maxInstitutions:20},华西:{regionType:"华西",baseColor:"#22c55e",colorRange:["#f0fdf4","#dcfce7","#bbf7d0","#86efac","#4ade80","#22c55e","#16a34a","#15803d","#166534"],maxInstitutions:20},华北:{regionType:"华北",baseColor:"#eab308",colorRange:["#fefce8","#fef9c3","#fef08a","#fde047","#facc15","#eab308","#ca8a04","#a16207","#854d0e"],maxInstitutions:20},华中:{regionType:"华中",baseColor:"#8b5cf6",colorRange:["#faf5ff","#f3e8ff","#e9d5ff","#d8b4fe","#c084fc","#a855f7","#9333ea","#7c3aed","#6d28d9"],maxInstitutions:20},东北:{regionType:"东北",baseColor:"#06b6d4",colorRange:["#ecfeff","#cffafe","#a5f3fc","#67e8f9","#22d3ee","#06b6d4","#0891b2","#0e7490","#155e75"],maxInstitutions:20},西北:{regionType:"西北",baseColor:"#f59e0b",colorRange:["#fffbeb","#fef3c7","#fde68a","#fcd34d","#fbbf24","#f59e0b","#d97706","#b45309","#92400e"],maxInstitutions:20}},Q=(s,t,n)=>{const a=T[s]||T.华东,r=n||a.maxInstitutions;if(t===0)return a.colorRange[0];const i=Math.min(t/r,1),o=Math.min(Math.floor(i*(a.colorRange.length-1))+1,a.colorRange.length-1);return a.colorRange[o]},we=s=>s.length===0?1:Math.max(...s.map(t=>t.institutions.length),1),z=s=>{const t={...T},n={};return s.forEach(a=>{const r=n[a.regionType]||0;n[a.regionType]=Math.max(r,a.institutions.length)}),Object.keys(t).forEach(a=>{n[a]&&(t[a]={...t[a],maxInstitutions:Math.max(n[a],5)})}),t},Se=s=>{const{colorRange:t,maxInstitutions:n}=s,a=[];for(let r=0;r<t.length;r++){const i=r===0?0:Math.ceil((r-1)*n/(t.length-2)),o=r===0?0:Math.ceil(r*n/(t.length-2));a.push({color:t[r],label:r===0?"无机构":r===t.length-1?`${i}+`:i===o?`${i}`:`${i}-${o}`,value:r===0?0:o,range:{min:i,max:o}})}return a},Re=s=>{const t=T[s];return t?t.baseColor:T.华东.baseColor},Ce=({colorSchemes:s,statistics:t,updatedColorSchemes:n})=>{var r;const a={华东:"华东地区",华南:"华南地区",华西:"华西地区",华北:"华北地区",华中:"华中地区",东北:"东北地区",西北:"西北地区"};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-feishu-accent",children:t.totalRegions}),e.jsx("div",{className:"text-sm text-feishu-secondary",children:"总地区数"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-feishu-success",children:t.totalInstitutions}),e.jsx("div",{className:"text-sm text-feishu-secondary",children:"总机构数"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-feishu-warning",children:t.activeRegions}),e.jsx("div",{className:"text-sm text-feishu-secondary",children:"活跃地区"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-feishu-primary truncate",children:((r=t.topRegion)==null?void 0:r.name)||"-"}),e.jsx("div",{className:"text-sm text-feishu-secondary",children:"机构最多"})]})]}),e.jsx("div",{className:"space-y-4",children:s.map(i=>{const o=n[i];if(!o)return null;const c=Se(o),l=a[i]||i;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm font-medium text-feishu-primary",children:[l," (最多 ",o.maxInstitutions," 家机构)"]}),e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:c.map((h,d)=>e.jsxs("div",{className:"flex items-center space-x-1 px-2 py-1 rounded-md bg-gray-50",children:[e.jsx("div",{className:"w-4 h-4 rounded border border-gray-300",style:{backgroundColor:h.color},title:`${h.label} 机构`}),e.jsx("span",{className:"text-xs text-feishu-secondary",children:h.label})]},d))})]},i)})}),e.jsx("div",{className:"text-xs text-feishu-secondary bg-feishu-background p-3 rounded-md",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("div",{className:"text-feishu-accent",children:"💡"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium mb-1",children:"使用说明:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"• 颜色深浅代表该地区的机构数量，颜色越深表示机构越多"}),e.jsx("li",{children:"• 点击地图上的省份可查看详细信息"}),e.jsx("li",{children:"• 使用右侧控制面板可以搜索和筛选地区"}),e.jsx("li",{children:"• 支持鼠标滚轮缩放和拖拽移动地图"})]})]})]})})]})},J=s=>{const t=s.flatMap(o=>o.institutions),n=t.filter(o=>o.status==="active"),a=t.filter(o=>o.status==="inactive"),r=s.reduce((o,c)=>{const l=c.regionType;return o[l]||(o[l]={institutionCount:0,managerCount:0}),o[l].institutionCount+=c.institutions.length,o[l].managerCount+=1,o},{}),i=s.reduce((o,c)=>c.institutions.length>o.institutions.length?c:o,s[0]||{institutions:[],name:"",manager:{name:""}});return{totalRegions:s.length,totalInstitutions:t.length,activeInstitutions:n.length,inactiveInstitutions:a.length,totalManagers:s.length,activeRegions:s.filter(o=>o.institutions.length>0).length,topRegion:{name:i.name,institutions:{length:i.institutions.length},manager:{name:i.manager.name}},regionStats:r}},Ie=(s,t,n="asc")=>[...s].sort((r,i)=>{let o=0;switch(t){case"name":o=r.name.localeCompare(i.name,"zh-CN");break;case"institutionCount":o=r.institutions.length-i.institutions.length;break;case"manager":o=r.manager.name.localeCompare(i.manager.name,"zh-CN");break}return n==="desc"?-o:o}),ee=s=>new Date(s).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}),De=({region:s,isOpen:t,onClose:n})=>{const[a,r]=N.useState("overview");if(!t||!s)return null;const i=Re(s.regionType),o=s.institutions.filter(l=>l.status==="active"),c=s.institutions.filter(l=>l.status==="inactive");return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 text-white relative",style:{backgroundColor:i},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:s.name}),e.jsxs("p",{className:"text-white text-opacity-90 mt-1",children:[s.regionType," · ",s.manager.name," 负责"]})]}),e.jsx("button",{onClick:n,className:"text-white hover:text-gray-200 text-2xl font-bold w-8 h-8 flex items-center justify-center rounded-full hover:bg-white hover:bg-opacity-20 transition-colors",children:"×"})]})}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"flex space-x-8 px-6",children:[{key:"overview",label:"概览",icon:"📊"},{key:"institutions",label:"机构列表",icon:"🏢"},{key:"manager",label:"负责人信息",icon:"👤"}].map(l=>e.jsxs("button",{onClick:()=>r(l.key),className:`py-3 px-1 border-b-2 font-medium text-sm transition-colors ${a===l.key?"border-feishu-accent text-feishu-accent":"border-transparent text-feishu-secondary hover:text-feishu-primary hover:border-gray-300"}`,children:[e.jsx("span",{className:"mr-2",children:l.icon}),l.label]},l.key))})}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:[a==="overview"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:s.institutions.length}),e.jsx("div",{className:"text-sm text-blue-800",children:"总机构数"})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:o.length}),e.jsx("div",{className:"text-sm text-green-800",children:"活跃机构"})]}),e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:c.length}),e.jsx("div",{className:"text-sm text-red-800",children:"停用机构"})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[Math.round(o.length/s.institutions.length*100)||0,"%"]}),e.jsx("div",{className:"text-sm text-purple-800",children:"活跃率"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-feishu-primary mb-3",children:"最新成立机构"}),e.jsx("div",{className:"space-y-2",children:s.institutions.sort((l,h)=>new Date(h.establishedDate).getTime()-new Date(l.establishedDate).getTime()).slice(0,3).map(l=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-feishu-primary",children:l.name}),e.jsx("div",{className:"text-sm text-feishu-secondary",children:l.address})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-feishu-secondary",children:ee(l.establishedDate)}),e.jsx("div",{className:`text-xs px-2 py-1 rounded-full ${l.status==="active"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:l.status==="active"?"活跃":"停用"})]})]},l.id))})]})]}),a==="institutions"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold text-feishu-primary",children:["机构列表 (",s.institutions.length,")"]}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs("span",{className:"text-sm text-feishu-secondary",children:["活跃: ",o.length," | 停用: ",c.length]})})]}),e.jsx("div",{className:"space-y-3",children:s.institutions.map(l=>e.jsx(ke,{institution:l},l.id))})]}),a==="manager"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center text-2xl",children:"👤"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-semibold text-feishu-primary",children:s.manager.name}),e.jsxs("p",{className:"text-feishu-secondary mt-1",children:[s.regionType,"负责人"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-feishu-primary",children:"联系信息"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-feishu-secondary",children:"📞"}),e.jsx("span",{children:s.manager.contact})]}),s.manager.email&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-feishu-secondary",children:"📧"}),e.jsx("span",{children:s.manager.email})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-feishu-primary",children:"管理统计"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-feishu-secondary",children:"管理地区:"}),e.jsx("span",{children:s.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-feishu-secondary",children:"机构总数:"}),e.jsx("span",{className:"font-semibold",children:s.institutions.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-feishu-secondary",children:"活跃机构:"}),e.jsx("span",{className:"text-green-600 font-semibold",children:o.length})]})]})]})]})]})]}),e.jsx("div",{className:"px-6 py-4 bg-gray-50 border-t border-gray-200 flex justify-end",children:e.jsx("button",{onClick:n,className:"feishu-button feishu-button-primary",children:"关闭"})})]})})},ke=({institution:s})=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h4",{className:"font-medium text-feishu-primary",children:s.name}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${s.status==="active"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.status==="active"?"活跃":"停用"})]}),e.jsxs("p",{className:"text-sm text-feishu-secondary mt-1",children:["📍 ",s.address]}),e.jsxs("p",{className:"text-sm text-feishu-secondary mt-1",children:["📅 成立于 ",ee(s.establishedDate)]}),s.description&&e.jsx("p",{className:"text-sm text-feishu-secondary mt-2",children:s.description})]})})}),Te=({onZoomIn:s,onZoomOut:t,onReset:n,onToggleFullscreen:a,isFullscreen:r})=>e.jsxs("div",{className:"absolute top-4 right-4 bg-white rounded-lg shadow-feishu border border-feishu-border p-2 space-y-1 z-10",children:[e.jsx("button",{onClick:s,className:"w-8 h-8 flex items-center justify-center hover:bg-gray-100 rounded text-feishu-primary transition-colors",title:"放大 (+)",children:"🔍+"}),e.jsx("button",{onClick:t,className:"w-8 h-8 flex items-center justify-center hover:bg-gray-100 rounded text-feishu-primary transition-colors",title:"缩小 (-)",children:"🔍-"}),e.jsx("button",{onClick:n,className:"w-8 h-8 flex items-center justify-center hover:bg-gray-100 rounded text-feishu-primary transition-colors",title:"重置视图 (R)",children:"🏠"}),e.jsx("div",{className:"border-t border-feishu-border my-1"}),e.jsx("button",{onClick:a,className:"w-8 h-8 flex items-center justify-center hover:bg-gray-100 rounded text-feishu-primary transition-colors",title:r?"退出全屏":"全屏显示",children:r?"⤓":"⤢"})]}),G=s=>{let t;const n=new Set,a=(d,m)=>{const g=typeof d=="function"?d(t):d;if(!Object.is(g,t)){const b=t;t=m??(typeof g!="object"||g===null)?g:Object.assign({},t,g),n.forEach(v=>v(t,b))}},r=()=>t,l={setState:a,getState:r,getInitialState:()=>h,subscribe:d=>(n.add(d),()=>n.delete(d)),destroy:()=>{n.clear()}},h=t=s(a,r,l);return l},Ee=s=>s?G(s):G;var te={exports:{}},se={},ne={exports:{}},ae={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var I=N;function Me(s,t){return s===t&&(s!==0||1/s===1/t)||s!==s&&t!==t}var Oe=typeof Object.is=="function"?Object.is:Me,_e=I.useState,Le=I.useEffect,Pe=I.useLayoutEffect,Ae=I.useDebugValue;function $e(s,t){var n=t(),a=_e({inst:{value:n,getSnapshot:t}}),r=a[0].inst,i=a[1];return Pe(function(){r.value=n,r.getSnapshot=t,P(r)&&i({inst:r})},[s,n,t]),Le(function(){return P(r)&&i({inst:r}),s(function(){P(r)&&i({inst:r})})},[s]),Ae(n),n}function P(s){var t=s.getSnapshot;s=s.value;try{var n=t();return!Oe(s,n)}catch{return!0}}function ze(s,t){return t()}var Fe=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?ze:$e;ae.useSyncExternalStore=I.useSyncExternalStore!==void 0?I.useSyncExternalStore:Fe;ne.exports=ae;var Be=ne.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _=N,Ue=Be;function We(s,t){return s===t&&(s!==0||1/s===1/t)||s!==s&&t!==t}var He=typeof Object.is=="function"?Object.is:We,Je=Ue.useSyncExternalStore,Ge=_.useRef,Ve=_.useEffect,Ze=_.useMemo,qe=_.useDebugValue;se.useSyncExternalStoreWithSelector=function(s,t,n,a,r){var i=Ge(null);if(i.current===null){var o={hasValue:!1,value:null};i.current=o}else o=i.current;i=Ze(function(){function l(b){if(!h){if(h=!0,d=b,b=a(b),r!==void 0&&o.hasValue){var v=o.value;if(r(v,b))return m=v}return m=b}if(v=m,He(d,b))return v;var f=a(b);return r!==void 0&&r(v,f)?(d=b,v):(d=b,m=f)}var h=!1,d,m,g=n===void 0?null:n;return[function(){return l(t())},g===null?void 0:function(){return l(g())}]},[t,n,a,r]);var c=Je(s,i[0],i[1]);return Ve(function(){o.hasValue=!0,o.value=c},[c]),qe(c),c};te.exports=se;var Xe=te.exports;const Ke=de(Xe),{useDebugValue:Ye}=X,{useSyncExternalStoreWithSelector:Qe}=Ke;const et=s=>s;function tt(s,t=et,n){const a=Qe(s.subscribe,s.getState,s.getServerState||s.getInitialState,t,n);return Ye(a),a}const V=s=>{const t=typeof s=="function"?Ee(s):s,n=(a,r)=>tt(t,a,r);return Object.assign(n,t),n},st=s=>s?V(s):V,F=new Map,M=s=>{const t=F.get(s);return t?Object.fromEntries(Object.entries(t.stores).map(([n,a])=>[n,a.getState()])):{}},nt=(s,t,n)=>{if(s===void 0)return{type:"untracked",connection:t.connect(n)};const a=F.get(n.name);if(a)return{type:"tracked",store:s,...a};const r={connection:t.connect(n),stores:{}};return F.set(n.name,r),{type:"tracked",store:s,...r}},at=(s,t={})=>(n,a,r)=>{const{enabled:i,anonymousActionType:o,store:c,...l}=t;let h;try{h=(i??!1)&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!h)return s(n,a,r);const{connection:d,...m}=nt(c,h,l);let g=!0;r.setState=(f,u,x)=>{const p=n(f,u);if(!g)return p;const j=x===void 0?{type:o||"anonymous"}:typeof x=="string"?{type:x}:x;return c===void 0?(d==null||d.send(j,a()),p):(d==null||d.send({...j,type:`${c}/${j.type}`},{...M(l.name),[c]:r.getState()}),p)};const b=(...f)=>{const u=g;g=!1,n(...f),g=u},v=s(r.setState,a,r);if(m.type==="untracked"?d==null||d.init(v):(m.stores[m.store]=r,d==null||d.init(Object.fromEntries(Object.entries(m.stores).map(([f,u])=>[f,f===m.store?v:u.getState()])))),r.dispatchFromDevtools&&typeof r.dispatch=="function"){let f=!1;const u=r.dispatch;r.dispatch=(...x)=>{u(...x)}}return d.subscribe(f=>{var u;switch(f.type){case"ACTION":if(typeof f.payload!="string"){console.error("[zustand devtools middleware] Unsupported action format");return}return A(f.payload,x=>{if(x.type==="__setState"){if(c===void 0){b(x.state);return}Object.keys(x.state).length!==1&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format. 
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);const p=x.state[c];if(p==null)return;JSON.stringify(r.getState())!==JSON.stringify(p)&&b(p);return}r.dispatchFromDevtools&&typeof r.dispatch=="function"&&r.dispatch(x)});case"DISPATCH":switch(f.payload.type){case"RESET":return b(v),c===void 0?d==null?void 0:d.init(r.getState()):d==null?void 0:d.init(M(l.name));case"COMMIT":if(c===void 0){d==null||d.init(r.getState());return}return d==null?void 0:d.init(M(l.name));case"ROLLBACK":return A(f.state,x=>{if(c===void 0){b(x),d==null||d.init(r.getState());return}b(x[c]),d==null||d.init(M(l.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return A(f.state,x=>{if(c===void 0){b(x);return}JSON.stringify(r.getState())!==JSON.stringify(x[c])&&b(x[c])});case"IMPORT_STATE":{const{nextLiftedState:x}=f.payload,p=(u=x.computedStates.slice(-1)[0])==null?void 0:u.state;if(!p)return;b(c===void 0?p:p[c]),d==null||d.send(null,x);return}case"PAUSE_RECORDING":return g=!g}return}}),v},rt=at,A=(s,t)=>{let n;try{n=JSON.parse(s)}catch(a){console.error("[zustand devtools middleware] Could not parse the received json",a)}n!==void 0&&t(n)};function it(s,t){let n;try{n=s()}catch{return}return{getItem:r=>{var i;const o=l=>l===null?null:JSON.parse(l,t==null?void 0:t.reviver),c=(i=n.getItem(r))!=null?i:null;return c instanceof Promise?c.then(o):o(c)},setItem:(r,i)=>n.setItem(r,JSON.stringify(i,t==null?void 0:t.replacer)),removeItem:r=>n.removeItem(r)}}const E=s=>t=>{try{const n=s(t);return n instanceof Promise?n:{then(a){return E(a)(n)},catch(a){return this}}}catch(n){return{then(a){return this},catch(a){return E(a)(n)}}}},ot=(s,t)=>(n,a,r)=>{let i={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:u=>u,version:0,merge:(u,x)=>({...x,...u}),...t},o=!1;const c=new Set,l=new Set;let h;try{h=i.getStorage()}catch{}if(!h)return s((...u)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),n(...u)},a,r);const d=E(i.serialize),m=()=>{const u=i.partialize({...a()});let x;const p=d({state:u,version:i.version}).then(j=>h.setItem(i.name,j)).catch(j=>{x=j});if(x)throw x;return p},g=r.setState;r.setState=(u,x)=>{g(u,x),m()};const b=s((...u)=>{n(...u),m()},a,r);let v;const f=()=>{var u;if(!h)return;o=!1,c.forEach(p=>p(a()));const x=((u=i.onRehydrateStorage)==null?void 0:u.call(i,a()))||void 0;return E(h.getItem.bind(h))(i.name).then(p=>{if(p)return i.deserialize(p)}).then(p=>{if(p)if(typeof p.version=="number"&&p.version!==i.version){if(i.migrate)return i.migrate(p.state,p.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return p.state}).then(p=>{var j;return v=i.merge(p,(j=a())!=null?j:b),n(v,!0),m()}).then(()=>{x==null||x(v,void 0),o=!0,l.forEach(p=>p(v))}).catch(p=>{x==null||x(void 0,p)})};return r.persist={setOptions:u=>{i={...i,...u},u.getStorage&&(h=u.getStorage())},clearStorage:()=>{h==null||h.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>f(),hasHydrated:()=>o,onHydrate:u=>(c.add(u),()=>{c.delete(u)}),onFinishHydration:u=>(l.add(u),()=>{l.delete(u)})},f(),v||b},lt=(s,t)=>(n,a,r)=>{let i={storage:it(()=>localStorage),partialize:f=>f,version:0,merge:(f,u)=>({...u,...f}),...t},o=!1;const c=new Set,l=new Set;let h=i.storage;if(!h)return s((...f)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),n(...f)},a,r);const d=()=>{const f=i.partialize({...a()});return h.setItem(i.name,{state:f,version:i.version})},m=r.setState;r.setState=(f,u)=>{m(f,u),d()};const g=s((...f)=>{n(...f),d()},a,r);r.getInitialState=()=>g;let b;const v=()=>{var f,u;if(!h)return;o=!1,c.forEach(p=>{var j;return p((j=a())!=null?j:g)});const x=((u=i.onRehydrateStorage)==null?void 0:u.call(i,(f=a())!=null?f:g))||void 0;return E(h.getItem.bind(h))(i.name).then(p=>{if(p)if(typeof p.version=="number"&&p.version!==i.version){if(i.migrate)return[!0,i.migrate(p.state,p.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,p.state];return[!1,void 0]}).then(p=>{var j;const[D,L]=p;if(b=i.merge(L,(j=a())!=null?j:g),n(b,!0),D)return d()}).then(()=>{x==null||x(b,void 0),b=a(),o=!0,l.forEach(p=>p(b))}).catch(p=>{x==null||x(void 0,p)})};return r.persist={setOptions:f=>{i={...i,...f},f.storage&&(h=f.storage)},clearStorage:()=>{h==null||h.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>v(),hasHydrated:()=>o,onHydrate:f=>(c.add(f),()=>{c.delete(f)}),onFinishHydration:f=>(l.add(f),()=>{l.delete(f)})},i.skipHydration||v(),b||g},ct=(s,t)=>"getStorage"in t||"serialize"in t||"deserialize"in t?ot(s,t):lt(s,t),dt=ct;class ut{constructor(t,n,a){w(this,"appToken");w(this,"tableId");w(this,"accessToken");w(this,"baseUrl","https://open.feishu.cn/open-apis/bitable/v1");this.appToken=t,this.tableId=n,this.accessToken=a}async getInstitutionRecords(){try{const t=await fetch(`${this.baseUrl}/apps/${this.appToken}/tables/${this.tableId}/records?page_size=100`,{method:"GET",headers:{Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`获取多维表格数据失败: ${t.statusText}`);return(await t.json()).data.items||[]}catch(t){throw console.error("获取多维表格数据失败:",t),t}}isValidRecord(t){const n=t.fields;return!!(n.机构名称&&n.机构名称.trim()!==""&&n.所属省份&&n.所属省份.trim()!==""&&n.管理区域&&n.管理区域.trim()!=="")}standardizeRecord(t){const n=t.fields;return{record_id:t.record_id,fields:{机构名称:n.机构名称||"未命名机构",机构地址:n.机构地址||`${n.所属省份||"未知省份"}地区`,所属省份:n.所属省份||"未知省份",管理区域:n.管理区域||"未分类",负责人:n.负责人||"未指定",负责人联系方式:n.负责人联系方式||"联系方式待补充",负责人邮箱:n.负责人邮箱||"",成立日期:n.成立日期||"2023-01-01",状态:n.状态||"活跃",备注:n.备注||""}}}async getManagerRecords(){return[]}transformToRegionData(t,n=[],a){const r=t.filter(h=>this.isValidRecord(h)),i=r.map(h=>this.standardizeRecord(h));console.log(`📊 数据处理: 原始${t.length}条 → 有效${r.length}条 → 标准化${i.length}条`);const o=i.reduce((h,d)=>{const m=d.fields.所属省份;return h[m]||(h[m]=[]),h[m].push(d),h},{}),c=n.reduce((h,d)=>{const m=d.fields.管理区域;return h[m]=d,h},{}),l=[];return Object.entries(o).forEach(([h,d])=>{var u;if(d.length===0||!h||h==="未知省份")return;let m;a?m=((u=Object.entries(a).find(([,x])=>x.includes(h)))==null?void 0:u[0])||"未分配":m=d[0].fields.管理区域;const g=c[m],b=d[0].fields.负责人,v=d.map(x=>({id:x.record_id,name:x.fields.机构名称,address:x.fields.机构地址,establishedDate:new Date(x.fields.成立日期),status:x.fields.状态==="活跃"?"active":"inactive",regionId:h,description:x.fields.备注})),f={id:h,name:h,regionType:m,manager:{id:(g==null?void 0:g.record_id)||`manager_${m}`,name:(g==null?void 0:g.fields.负责人姓名)||b,contact:(g==null?void 0:g.fields.联系电话)||d[0].fields.负责人联系方式,email:(g==null?void 0:g.fields.邮箱地址)||d[0].fields.负责人邮箱,avatar:g==null?void 0:g.fields.头像},institutions:v};l.push(f)}),l}async subscribeToChanges(t){const a=async()=>{try{const r=await this.getInstitutionRecords(),i=await this.getManagerRecords(),o=this.transformToRegionData(r,i);t(o)}catch(r){console.error("轮询数据失败:",r)}};await a(),setInterval(a,3e4)}async updateInstitutionStatus(t,n){try{const a=await fetch(`${this.baseUrl}/apps/${this.appToken}/tables/${this.tableId}/records/${t}`,{method:"PUT",headers:{Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json"},body:JSON.stringify({fields:{状态:n}})});if(!a.ok)throw new Error(`更新记录失败: ${a.statusText}`)}catch(a){throw console.error("更新多维表格记录失败:",a),a}}async addInstitution(t){try{const n=await fetch(`${this.baseUrl}/apps/${this.appToken}/tables/${this.tableId}/records`,{method:"POST",headers:{Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json"},body:JSON.stringify({fields:{机构名称:t.name,机构地址:t.address,所属省份:t.province,管理区域:t.regionType,负责人:t.manager,负责人联系方式:t.contact,负责人邮箱:t.email,成立日期:t.establishedDate.toISOString().split("T")[0],状态:t.status,备注:t.description}})});if(!n.ok)throw new Error(`添加记录失败: ${n.statusText}`);return(await n.json()).data.record.record_id}catch(n){throw console.error("添加多维表格记录失败:",n),n}}}const ht=(s,t)=>s.map(n=>{var r;const a=(r=Object.entries(t).find(([,i])=>i.includes(n.name)))==null?void 0:r[0];return a&&a!==n.regionType?{...n,regionType:a}:n}),mt={regions:[],colorSchemes:{},statistics:null,selectedRegion:null,hoveredRegion:null,showControls:!0,showDetailModal:!1,isFullscreen:!1,filterOptions:{},searchTerm:"",sortBy:"name",sortOrder:"asc",loadingState:{isLoading:!1,error:null,lastUpdated:null},userProfile:null,bitableConfig:{appToken:"PGuTbyauXavdl7s8Jpec2lUAnah",tableId:"tblLawFGl4bUcqHA",accessToken:"t-g10495bGB7VY3MTCZ2IWG6WD7DUIX74OD2RLW26I"},dataSource:"bitable",regionMapping:null},S=st()(rt(dt((s,t)=>({...mt,loadRegions:async()=>{const{dataSource:n,bitableConfig:a,regionMapping:r}=t();s(i=>({loadingState:{...i.loadingState,isLoading:!0,error:null}}));try{let i;if(n==="bitable"&&a){const l=new ut(a.appToken,a.tableId,a.accessToken),h=await l.getInstitutionRecords(),d=await l.getManagerRecords();i=l.transformToRegionData(h,d,r)}else await new Promise(l=>setTimeout(l,1e3)),i=r?ht(H,r):H;const o=z(i),c=J(i);s({regions:i,colorSchemes:o,statistics:c,loadingState:{isLoading:!1,error:null,lastUpdated:Date.now()}})}catch(i){s(o=>({loadingState:{...o.loadingState,isLoading:!1,error:{code:"LOAD_ERROR",message:i instanceof Error?i.message:"加载数据失败",details:i instanceof Error?{message:i.message}:void 0,timestamp:Date.now()}}}))}},loadFromBitable:async n=>{s({bitableConfig:n,dataSource:"bitable"});const{loadRegions:a}=t();await a()},updateRegion:(n,a)=>{s(r=>{const i=r.regions.map(o=>o.id===n?{...o,...a}:o);return{regions:i,statistics:J(i),colorSchemes:z(i)}})},refreshData:async()=>{const{loadRegions:n}=t();await n()},switchDataSource:n=>{s({dataSource:n})},setSelectedRegion:n=>{const a=n?t().regions.find(r=>r.id===n||r.name===n):null;s({selectedRegion:a})},setHoveredRegion:n=>{s({hoveredRegion:n})},toggleControls:()=>{s(n=>({showControls:!n.showControls}))},toggleDetailModal:n=>{s(a=>({showDetailModal:n!==void 0?n:!a.showDetailModal}))},toggleFullscreen:()=>{s(n=>({isFullscreen:!n.isFullscreen}))},setFilterOptions:n=>{s(a=>({filterOptions:{...a.filterOptions,...n}}))},setSearchTerm:n=>{s({searchTerm:n})},setSorting:(n,a="asc")=>{s({sortBy:n,sortOrder:a})},clearFilters:()=>{s({filterOptions:{},searchTerm:"",sortBy:"name",sortOrder:"asc"})},getFilteredRegions:()=>{const{regions:n,filterOptions:a,searchTerm:r,sortBy:i,sortOrder:o}=t();let c=n;return r&&(c=c.filter(l=>l.name.toLowerCase().includes(r.toLowerCase())||l.manager.name.toLowerCase().includes(r.toLowerCase())||l.regionType.toLowerCase().includes(r.toLowerCase()))),a.regionTypes&&a.regionTypes.length>0&&(c=c.filter(l=>a.regionTypes.includes(l.regionType))),a.managerIds&&a.managerIds.length>0&&(c=c.filter(l=>a.managerIds.includes(l.manager.id))),a.institutionStatus&&a.institutionStatus.length>0&&(c=c.filter(l=>l.institutions.some(h=>a.institutionStatus.includes(h.status)))),a.dateRange&&(c=c.filter(l=>l.institutions.some(h=>{const d=new Date(h.establishedDate);return d>=a.dateRange.start&&d<=a.dateRange.end}))),Ie(c,i,o)},getRegionColor:(n,a)=>{const{colorSchemes:r}=t(),i=Math.max(...Object.values(r).map(o=>o.maxInstitutions),1);return Q(n,a,i)},setUserProfile:n=>{s({userProfile:n})},setError:n=>{s(a=>({loadingState:{...a.loadingState,error:n?{code:"GENERAL_ERROR",message:n,details:void 0,timestamp:Date.now()}:null}}))},clearError:()=>{s(n=>({loadingState:{...n.loadingState,error:null}}))},setRegionMapping:n=>{s({regionMapping:n})},getProvinceRegion:n=>{const{regionMapping:a}=t();if(!a)return null;for(const[r,i]of Object.entries(a))if(i.includes(n))return r;return null}}),{name:"map-store",partialize:s=>({showControls:s.showControls,filterOptions:s.filterOptions,sortBy:s.sortBy,sortOrder:s.sortOrder,userProfile:s.userProfile,regionMapping:s.regionMapping})}),{name:"map-store"})),ft=()=>S(s=>s.regions),xt=()=>S(s=>s.selectedRegion),gt=()=>S(s=>s.loadingState),re=()=>S(s=>s.statistics),pt=()=>S(s=>({showControls:s.showControls,showDetailModal:s.showDetailModal,isFullscreen:s.isFullscreen,hoveredRegion:s.hoveredRegion})),ie=()=>S(s=>({loadRegions:s.loadRegions,setSelectedRegion:s.setSelectedRegion,setHoveredRegion:s.setHoveredRegion,toggleControls:s.toggleControls,toggleDetailModal:s.toggleDetailModal,toggleFullscreen:s.toggleFullscreen,setFilterOptions:s.setFilterOptions,setSearchTerm:s.setSearchTerm,setSorting:s.setSorting,clearFilters:s.clearFilters,refreshData:s.refreshData,setError:s.setError,clearError:s.clearError})),bt=({regions:s,loading:t=!1,onRegionSelect:n})=>{const a=xt(),{showControls:r,showDetailModal:i,isFullscreen:o,hoveredRegion:c}=pt(),l=re(),{setSelectedRegion:h,setHoveredRegion:d,toggleControls:m,toggleDetailModal:g,toggleFullscreen:b}=ie(),v=we(s),f=z(s),u=s.map(y=>({name:y.name,value:y.institutions.length,regionType:y.regionType,manager:y.manager.name,itemStyle:{color:Q(y.regionType,y.institutions.length,v)}})),x=y=>{switch(y.type){case"click":h(y.data.regionId),g(!0),n==null||n(y.data.regionId);break;case"hover":d(y.data.regionId);break}},p=()=>{console.log("Zoom in")},j=()=>{console.log("Zoom out")},D=()=>{console.log("Reset view")},L=l||{totalRegions:s.length,totalInstitutions:s.reduce((y,R)=>y+R.institutions.length,0),activeRegions:s.filter(y=>y.institutions.length>0).length,topRegion:s.reduce((y,R)=>R.institutions.length>y.institutions.length?R:y,s[0]||{institutions:[],name:"",manager:{name:""}})};return e.jsxs("div",{className:"relative w-full h-full bg-white rounded-lg shadow-feishu",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-feishu-border",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-feishu-primary",children:"中国地图仪表盘"}),e.jsxs("p",{className:"text-sm text-feishu-secondary mt-1",children:["共 ",(l==null?void 0:l.totalRegions)||s.length," 个地区，",(l==null?void 0:l.totalInstitutions)||s.reduce((y,R)=>y+R.institutions.length,0)," 家机构"]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("button",{onClick:m,className:"feishu-button feishu-button-secondary text-sm",children:r?"隐藏控制":"显示控制"})})]}),e.jsxs("div",{className:"relative flex h-[700px]",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(je,{data:u,onMapEvent:x,loading:t,className:"w-full h-full"}),e.jsx(Te,{onZoomIn:p,onZoomOut:j,onReset:D,onToggleFullscreen:b,isFullscreen:o}),c&&!i&&e.jsx("div",{className:"absolute top-4 left-4 bg-white rounded-lg shadow-feishu border border-feishu-border p-3 z-10",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium text-feishu-primary",children:c}),e.jsx("div",{className:"text-feishu-secondary",children:"点击查看详细信息"})]})}),t&&e.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-80 flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-feishu-accent"}),e.jsx("span",{className:"text-feishu-secondary",children:"加载地图数据..."})]})})]}),r&&e.jsx("div",{className:"w-80 border-l border-feishu-border bg-feishu-background",children:e.jsx(Ne,{regions:s,selectedRegion:(a==null?void 0:a.name)||null,onRegionSelect:y=>h(y)})})]}),e.jsx("div",{className:"p-4 border-t border-feishu-border",children:e.jsx(Ce,{colorSchemes:Object.keys(s.reduce((y,R)=>(y[R.regionType]=!0,y),{})),statistics:L,updatedColorSchemes:f})}),e.jsx(De,{region:a,isOpen:i,onClose:()=>{g(!1),h(null)}})]})},vt=({isOpen:s,onClose:t})=>{const{dataSource:n,bitableConfig:a,loadFromBitable:r,switchDataSource:i}=S(),[o,c]=N.useState({appToken:(a==null?void 0:a.appToken)||"PGuTbyauXavdl7s8Jpec2lUAnah",tableId:(a==null?void 0:a.tableId)||"tblLawFGl4bUcqHA",accessToken:(a==null?void 0:a.accessToken)||"t-g10495bGB7VY3MTCZ2IWG6WD7DUIX74OD2RLW26I"}),[l,h]=N.useState(!1);if(!s)return null;const d=async g=>{g.preventDefault(),h(!0);try{await r(o),t()}catch(b){console.error("连接多维表格失败:",b),alert("连接多维表格失败，请检查配置信息")}finally{h(!1)}},m=()=>{i("mock"),t()};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-feishu-primary",children:"数据源配置"}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 text-2xl font-bold",children:"×"})]})}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-blue-600",children:"📊"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-blue-800",children:["当前数据源: ",n==="bitable"?"飞书多维表格":"演示数据"]}),n==="bitable"&&a&&e.jsxs("div",{className:"text-sm text-blue-600 mt-1",children:["表格ID: ",a.tableId]})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-feishu-primary",children:"选择数据源"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center",children:"🎭"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-feishu-primary",children:"演示数据"}),e.jsx("p",{className:"text-sm text-feishu-secondary",children:"使用内置的示例数据"})]})]}),e.jsx("button",{onClick:m,className:"w-full mt-3 feishu-button feishu-button-secondary",disabled:n==="mock",children:n==="mock"?"当前使用":"切换到演示数据"})]}),e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:"📋"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-feishu-primary",children:"飞书多维表格"}),e.jsx("p",{className:"text-sm text-feishu-secondary",children:"连接真实的业务数据"})]})]})})]})]}),e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-feishu-primary",children:"多维表格配置"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-feishu-primary mb-1",children:"应用 Token (App Token)"}),e.jsx("input",{type:"text",value:o.appToken,onChange:g=>c({...o,appToken:g.target.value}),placeholder:"bascnCMII2ORuAUfTm9IZjXMEuD",className:"w-full px-3 py-2 border border-feishu-border rounded-md focus:outline-none focus:ring-2 focus:ring-feishu-accent focus:border-transparent",required:!0}),e.jsxs("p",{className:"text-xs text-feishu-secondary mt-1",children:["从多维表格 URL 中获取，格式如：https://example.feishu.cn/base/",e.jsx("strong",{children:"bascnCMII2ORuAUfTm9IZjXMEuD"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-feishu-primary mb-1",children:"表格 ID (Table ID)"}),e.jsx("input",{type:"text",value:o.tableId,onChange:g=>c({...o,tableId:g.target.value}),placeholder:"tblxI2tWaxP5dG7p",className:"w-full px-3 py-2 border border-feishu-border rounded-md focus:outline-none focus:ring-2 focus:ring-feishu-accent focus:border-transparent",required:!0}),e.jsx("p",{className:"text-xs text-feishu-secondary mt-1",children:"从表格 URL 中获取，或在表格设置中查看"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-feishu-primary mb-1",children:"访问令牌 (Access Token)"}),e.jsx("input",{type:"password",value:o.accessToken,onChange:g=>c({...o,accessToken:g.target.value}),placeholder:"请输入访问令牌",className:"w-full px-3 py-2 border border-feishu-border rounded-md focus:outline-none focus:ring-2 focus:ring-feishu-accent focus:border-transparent",required:!0}),e.jsx("p",{className:"text-xs text-feishu-secondary mt-1",children:"通过飞书开放平台获取的访问令牌"})]})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-green-800 mb-2",children:"✅ 已适配你的字段结构"}),e.jsxs("div",{className:"text-sm text-green-700 space-y-1",children:[e.jsxs("div",{children:["• ",e.jsx("strong",{children:"机构名称"}),": ✅ 完全匹配"]}),e.jsxs("div",{children:["• ",e.jsx("strong",{children:"所属省份"}),": ✅ 完全匹配"]}),e.jsxs("div",{children:["• ",e.jsx("strong",{children:"所属区域"}),": ✅ 映射为管理区域"]}),e.jsxs("div",{children:["• ",e.jsx("strong",{children:"管理人"}),": ✅ 映射为负责人"]}),e.jsxs("div",{children:["• ",e.jsx("strong",{children:"机构地址"}),": 🔧 自动生成（省份+地区）"]}),e.jsxs("div",{children:["• ",e.jsx("strong",{children:"联系方式"}),": 🔧 使用默认值"]}),e.jsxs("div",{children:["• ",e.jsx("strong",{children:"成立日期"}),": 🔧 使用默认值"]}),e.jsxs("div",{children:["• ",e.jsx("strong",{children:"状态"}),": 🔧 默认为活跃"]})]}),e.jsx("div",{className:"mt-2 text-xs text-green-600",children:"🎉 你的多维表格已完美适配，可以直接使用！"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"submit",disabled:l,className:"flex-1 feishu-button feishu-button-primary",children:l?"连接中...":"连接多维表格"}),e.jsx("button",{type:"button",onClick:t,className:"feishu-button feishu-button-secondary",children:"取消"})]})]})]})})]})})},Z=["北京市","上海市","天津市","重庆市","河北省","山西省","辽宁省","吉林省","黑龙江省","江苏省","浙江省","安徽省","福建省","江西省","山东省","河南省","湖北省","湖南省","广东省","海南省","四川省","贵州省","云南省","陕西省","甘肃省","青海省","台湾省","内蒙古自治区","广西壮族自治区","西藏自治区","宁夏回族自治区","新疆维吾尔自治区","香港特别行政区","澳门特别行政区"],q={华东:["上海市","江苏省","浙江省","安徽省","福建省","江西省","山东省"],华南:["广东省","广西壮族自治区","海南省","香港特别行政区","澳门特别行政区"],华西:["四川省","贵州省","云南省","西藏自治区"],华北:["北京市","天津市","河北省","山西省","内蒙古自治区"],华中:["河南省","湖北省","湖南省"],东北:["辽宁省","吉林省","黑龙江省"],西北:["陕西省","甘肃省","青海省","宁夏回族自治区","新疆维吾尔自治区"],其他:["台湾省"]},yt=({isOpen:s,onClose:t})=>{const{regionMapping:n,setRegionMapping:a}=S(),[r,i]=N.useState(n||q),[o,c]=N.useState("");if(!s)return null;const l=Object.values(r).flat(),h=Z.filter(u=>!l.includes(u)),d=()=>{o.trim()&&!r[o.trim()]&&(i({...r,[o.trim()]:[]}),c(""))},m=u=>{const x={...r};delete x[u],i(x)},g=(u,x)=>{const p={...r};Object.keys(p).forEach(j=>{p[j]=p[j].filter(D=>D!==x)}),p[u]=[...p[u],x],i(p)},b=(u,x)=>{i({...r,[u]:r[u].filter(p=>p!==x)})},v=()=>{a(r),t()},f=()=>{i(q)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-feishu-primary",children:"管理区域配置"}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 text-2xl font-bold",children:"×"})]}),e.jsx("p",{className:"text-sm text-feishu-secondary mt-1",children:"自定义省份与管理区域的对应关系，每个省份只能属于一个管理区域"})]}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[70vh]",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-feishu-primary",children:"管理区域"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"text",value:o,onChange:u=>c(u.target.value),placeholder:"输入新区域名称",className:"px-3 py-1 border border-feishu-border rounded text-sm",onKeyPress:u=>u.key==="Enter"&&d()}),e.jsx("button",{onClick:d,className:"feishu-button feishu-button-primary text-sm",disabled:!o.trim(),children:"添加区域"})]})]}),e.jsx("div",{className:"space-y-3",children:Object.entries(r).map(([u,x])=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"font-medium text-feishu-primary flex items-center",children:[e.jsx("div",{className:"w-4 h-4 rounded mr-2",style:{backgroundColor:jt(u)}}),u," (",x.length,"个省份)"]}),e.jsx("button",{onClick:()=>m(u),className:"text-red-500 hover:text-red-700 text-sm",children:"删除区域"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[x.map(p=>e.jsxs("div",{className:"flex items-center bg-gray-100 rounded-full px-3 py-1 text-sm",children:[e.jsx("span",{children:p}),e.jsx("button",{onClick:()=>b(u,p),className:"ml-2 text-gray-500 hover:text-red-500",children:"×"})]},p)),x.length===0&&e.jsx("div",{className:"text-gray-400 text-sm italic",children:"暂无省份，请从右侧添加"})]})]},u))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-feishu-primary",children:["未分配省份 (",h.length,")"]}),e.jsxs("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:[h.map(u=>e.jsxs("div",{className:"flex items-center justify-between p-2 border border-gray-200 rounded",children:[e.jsx("span",{className:"text-sm",children:u}),e.jsxs("select",{value:"",onChange:x=>{x.target.value&&g(x.target.value,u)},className:"text-xs border border-gray-300 rounded px-2 py-1",children:[e.jsx("option",{value:"",children:"分配到..."}),Object.keys(r).map(x=>e.jsx("option",{value:x,children:x},x))]})]},u)),h.length===0&&e.jsx("div",{className:"text-center text-gray-400 text-sm py-4",children:"所有省份都已分配"})]})]})]}),e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:"配置统计"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-blue-600 font-semibold",children:Object.keys(r).length}),e.jsx("div",{className:"text-blue-800",children:"管理区域"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-blue-600 font-semibold",children:l.length}),e.jsx("div",{className:"text-blue-800",children:"已分配省份"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-blue-600 font-semibold",children:h.length}),e.jsx("div",{className:"text-blue-800",children:"未分配省份"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-blue-600 font-semibold",children:Z.length}),e.jsx("div",{className:"text-blue-800",children:"总省份数"})]})]})]})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 border-t border-gray-200 flex justify-between",children:[e.jsx("button",{onClick:f,className:"feishu-button feishu-button-secondary",children:"重置为默认"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:t,className:"feishu-button feishu-button-secondary",children:"取消"}),e.jsx("button",{onClick:v,className:"feishu-button feishu-button-primary",children:"保存配置"})]})]})]})})},jt=s=>({华东:"#3b82f6",华南:"#ef4444",华西:"#22c55e",华北:"#eab308",华中:"#8b5cf6",东北:"#06b6d4",西北:"#f59e0b",其他:"#6b7280"})[s]||"#6b7280",C=class C{constructor(){w(this,"isInitialized",!1);w(this,"onConfirmCallback");w(this,"onCancelCallback")}static getInstance(){return C.instance||(C.instance=new C),C.instance}async initialize(){if(!this.isInitialized)try{if(typeof window.h5sdk>"u"){console.warn("飞书 SDK 未加载，使用演示模式"),this.initDemoMode();return}await window.h5sdk.ready();const t=await this.getPluginConfig();console.log("插件配置:",t),this.showActionButtons(),this.setupEventListeners(),this.isInitialized=!0,console.log("飞书插件初始化成功")}catch(t){console.error("飞书插件初始化失败:",t),this.initDemoMode()}}initDemoMode(){console.log("启动演示模式"),this.isInitialized=!0,setTimeout(()=>{this.showActionButtons()},1e3)}async getPluginConfig(){try{if(window.h5sdk&&window.h5sdk.bitable)return{data:await window.h5sdk.bitable.base.getSelection(),width:800,height:600}}catch(t){console.error("获取插件配置失败:",t)}return{width:800,height:600}}showActionButtons(){const t=document.getElementById("plugin-actions");t&&(t.style.display="block")}hideActionButtons(){const t=document.getElementById("plugin-actions");t&&(t.style.display="none")}setupEventListeners(){const t=document.getElementById("confirm-btn"),n=document.getElementById("cancel-btn");t&&t.addEventListener("click",()=>{this.handleConfirm()}),n&&n.addEventListener("click",()=>{this.handleCancel()})}async handleConfirm(){try{console.log("用户点击确认");const t=this.getCurrentPluginData();this.onConfirmCallback&&this.onConfirmCallback(t),window.h5sdk?(await this.savePluginData(t),await window.h5sdk.bridge.close()):(this.showMessage("配置已保存（演示模式）","success"),this.hideActionButtons())}catch(t){console.error("确认操作失败:",t),this.showMessage("保存失败，请重试","error")}}async handleCancel(){try{console.log("用户点击取消"),this.onCancelCallback&&this.onCancelCallback(),window.h5sdk?await window.h5sdk.bridge.close():(this.showMessage("已取消配置","info"),this.hideActionButtons())}catch(t){console.error("取消操作失败:",t)}}getCurrentPluginData(){return{timestamp:Date.now(),config:{dataSource:localStorage.getItem("feishu-map-datasource")||"demo",regionMapping:JSON.parse(localStorage.getItem("feishu-map-regions")||"{}"),colorScheme:localStorage.getItem("feishu-map-colors")||"default"}}}async savePluginData(t){if(window.h5sdk&&window.h5sdk.bitable)try{console.log("保存插件数据:",t)}catch(n){throw console.error("保存数据失败:",n),n}}showMessage(t,n="info"){const a=document.createElement("div");a.style.cssText=`
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 12px 24px;
      border-radius: 4px;
      color: white;
      font-size: 14px;
      z-index: 10000;
      background: ${n==="success"?"#52c41a":n==="error"?"#ff4d4f":"#1890ff"};
    `,a.textContent=t,document.body.appendChild(a),setTimeout(()=>{a.parentNode&&a.parentNode.removeChild(a)},3e3)}onConfirm(t){this.onConfirmCallback=t}onCancel(t){this.onCancelCallback=t}isInFeishuEnvironment(){return typeof window.h5sdk<"u"}async getUserInfo(){if(window.h5sdk&&window.h5sdk.bitable)try{return await window.h5sdk.bitable.bridge.getUserInfo()}catch(t){return console.error("获取用户信息失败:",t),null}return null}async getBitableData(){if(window.h5sdk&&window.h5sdk.bitable)try{const t=await window.h5sdk.bitable.base.getSelection();if(t&&t.tableId)return await(await window.h5sdk.bitable.base.getTableById(t.tableId)).getRecords()}catch(t){console.error("获取多维表格数据失败:",t)}return null}};w(C,"instance");let B=C;const k=B.getInstance(),Nt=()=>{const s=ft(),t=gt(),n=re(),{loadRegions:a,setSelectedRegion:r}=ie(),{dataSource:i}=S(),[o,c]=N.useState(!1),[l,h]=N.useState(!1);N.useEffect(()=>{(async()=>{try{if(await k.initialize(),k.onConfirm(g=>{console.log("插件确认，保存数据:",g)}),k.onCancel(()=>{console.log("插件取消")}),a(),k.isInFeishuEnvironment()){const g=await k.getBitableData();g&&console.log("获取到多维表格数据:",g)}}catch(g){console.error("插件初始化失败:",g),a()}})()},[a]);const d=m=>{r(m),console.log("选中地区:",m)};return e.jsx("div",{className:"min-h-screen bg-feishu-background",children:e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx("header",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-feishu-primary",children:"中国地图仪表盘"}),e.jsx("p",{className:"text-feishu-secondary mt-2 text-lg",children:"根据地区负责人机构数量进行颜色标记"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-feishu-secondary",children:"数据源"}),e.jsx("div",{className:"font-medium text-feishu-primary",children:i==="bitable"?"飞书多维表格":"演示数据"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>h(!0),className:"feishu-button feishu-button-secondary",children:"🗺️ 区域配置"}),e.jsx("button",{onClick:()=>c(!0),className:"feishu-button feishu-button-secondary",children:"⚙️ 数据源"})]})]})]})}),e.jsx("div",{className:"mb-6",children:e.jsx(bt,{regions:s,loading:t.isLoading,onRegionSelect:d})}),t.error&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-red-500",children:"⚠️"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-red-800",children:"加载失败"}),e.jsx("div",{className:"text-sm text-red-600",children:t.error.message})]})]})}),!t.isLoading&&s.length>0&&n&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"feishu-card p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-feishu-accent",children:n.totalRegions}),e.jsx("div",{className:"text-feishu-secondary",children:"覆盖省份"})]}),e.jsxs("div",{className:"feishu-card p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-feishu-success",children:n.totalInstitutions}),e.jsx("div",{className:"text-feishu-secondary",children:"总机构数"})]}),e.jsxs("div",{className:"feishu-card p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-feishu-warning",children:n.totalManagers}),e.jsx("div",{className:"text-feishu-secondary",children:"负责人数"})]}),e.jsxs("div",{className:"feishu-card p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-feishu-primary",children:n.activeInstitutions}),e.jsx("div",{className:"text-feishu-secondary",children:"活跃机构"})]})]}),e.jsx(vt,{isOpen:o,onClose:()=>c(!1)}),e.jsx(yt,{isOpen:l,onClose:()=>h(!1)})]})})};function wt(){return e.jsx("div",{className:"min-h-screen bg-feishu-background",children:e.jsx(Nt,{})})}$.createRoot(document.getElementById("root")).render(e.jsx(X.StrictMode,{children:e.jsx(wt,{})}));
//# sourceMappingURL=index-d3d5ec2e.js.map
