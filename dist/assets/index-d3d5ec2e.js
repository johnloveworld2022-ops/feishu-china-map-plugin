var oe=Object.defineProperty;var le=(s,t,n)=>t in s?oe(s,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[t]=n;var w=(s,t,n)=>(le(s,typeof t!="symbol"?t+"":t,n),n);import{r as N,a as ce,g as de,R as X}from"./vendor-57209f9c.js";import{i as ue,r as U}from"./echarts-9fe7269c.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();var K={exports:{}},O={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var he=N,me=Symbol.for("react.element"),fe=Symbol.for("react.fragment"),xe=Object.prototype.hasOwnProperty,ge=he.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,pe={key:!0,ref:!0,__self:!0,__source:!0};function Y(s,t,n){var a,r={},i=null,o=null;n!==void 0&&(i=""+n),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(o=t.ref);for(a in t)xe.call(t,a)&&!pe.hasOwnProperty(a)&&(r[a]=t[a]);if(s&&s.defaultProps)for(a in t=s.defaultProps,t)r[a]===void 0&&(r[a]=t[a]);return{$$typeof:me,type:s,key:i,ref:o,props:r,_owner:ge.current}}O.Fragment=fe;O.jsx=Y;O.jsxs=Y;K.exports=O;var e=K.exports,$={},W=ce;$.createRoot=W.createRoot,$.hydrateRoot=W.hydrateRoot;const be={type:"FeatureCollection",features:[{type:"Feature",properties:{name:"åŒ—äº¬å¸‚",adcode:"110000"},geometry:{type:"Polygon",coordinates:[[[116.4,39.9],[116.5,39.9],[116.5,40],[116.4,40],[116.4,39.9]]]}},{type:"Feature",properties:{name:"ä¸Šæµ·å¸‚",adcode:"310000"},geometry:{type:"Polygon",coordinates:[[[121.4,31.2],[121.5,31.2],[121.5,31.3],[121.4,31.3],[121.4,31.2]]]}},{type:"Feature",properties:{name:"å¹¿ä¸œçœ",adcode:"440000"},geometry:{type:"Polygon",coordinates:[[[113.2,23.1],[113.3,23.1],[113.3,23.2],[113.2,23.2],[113.2,23.1]]]}},{type:"Feature",properties:{name:"æµ™æ±Ÿçœ",adcode:"330000"},geometry:{type:"Polygon",coordinates:[[[120.1,30.2],[120.2,30.2],[120.2,30.3],[120.1,30.3],[120.1,30.2]]]}},{type:"Feature",properties:{name:"æ±Ÿè‹çœ",adcode:"320000"},geometry:{type:"Polygon",coordinates:[[[118.7,32],[118.8,32],[118.8,32.1],[118.7,32.1],[118.7,32]]]}},{type:"Feature",properties:{name:"å››å·çœ",adcode:"510000"},geometry:{type:"Polygon",coordinates:[[[104,30.6],[104.1,30.6],[104.1,30.7],[104,30.7],[104,30.6]]]}}]},H=[{id:"1",name:"ä¸Šæµ·å¸‚",regionType:"åä¸œ",manager:{id:"m1",name:"å°é»„",contact:"13800138001",email:"xiaohuang@example.com"},institutions:[{id:"i1",name:"ä¸Šæµ·åˆ†å…¬å¸",address:"ä¸Šæµ·å¸‚æµ¦ä¸œæ–°åŒº",establishedDate:new Date("2020-01-15"),status:"active",regionId:"1"},{id:"i2",name:"ä¸Šæµ·åŠäº‹å¤„",address:"ä¸Šæµ·å¸‚é»„æµ¦åŒº",establishedDate:new Date("2021-03-20"),status:"active",regionId:"1"},{id:"i3",name:"ä¸Šæµ·ç ”å‘ä¸­å¿ƒ",address:"ä¸Šæµ·å¸‚å¾æ±‡åŒº",establishedDate:new Date("2022-06-10"),status:"active",regionId:"1"}]},{id:"2",name:"å¹¿ä¸œçœ",regionType:"åå—",manager:{id:"m2",name:"å°æ",contact:"13800138002",email:"xiaoli@example.com"},institutions:[{id:"i4",name:"å¹¿å·åˆ†å…¬å¸",address:"å¹¿å·å¸‚å¤©æ²³åŒº",establishedDate:new Date("2019-08-12"),status:"active",regionId:"2"},{id:"i5",name:"æ·±åœ³åŠäº‹å¤„",address:"æ·±åœ³å¸‚å—å±±åŒº",establishedDate:new Date("2020-11-05"),status:"active",regionId:"2"}]},{id:"3",name:"åŒ—äº¬å¸‚",regionType:"ååŒ—",manager:{id:"m3",name:"å°ç‹",contact:"13800138003",email:"xiaowang@example.com"},institutions:[{id:"i6",name:"åŒ—äº¬æ€»éƒ¨",address:"åŒ—äº¬å¸‚æœé˜³åŒº",establishedDate:new Date("2018-01-01"),status:"active",regionId:"3"},{id:"i7",name:"åŒ—äº¬ç ”å‘éƒ¨",address:"åŒ—äº¬å¸‚æµ·æ·€åŒº",establishedDate:new Date("2019-05-15"),status:"active",regionId:"3"},{id:"i8",name:"åŒ—äº¬é”€å”®éƒ¨",address:"åŒ—äº¬å¸‚è¥¿åŸåŒº",establishedDate:new Date("2020-09-20"),status:"active",regionId:"3"},{id:"i9",name:"åŒ—äº¬å®¢æœä¸­å¿ƒ",address:"åŒ—äº¬å¸‚ä¸œåŸåŒº",establishedDate:new Date("2021-12-01"),status:"active",regionId:"3"}]},{id:"4",name:"æµ™æ±Ÿçœ",regionType:"åä¸œ",manager:{id:"m4",name:"å°å¼ ",contact:"13800138004",email:"xiaozhang@example.com"},institutions:[{id:"i10",name:"æ­å·åˆ†å…¬å¸",address:"æ­å·å¸‚è¥¿æ¹–åŒº",establishedDate:new Date("2020-04-10"),status:"active",regionId:"4"}]},{id:"5",name:"æ±Ÿè‹çœ",regionType:"åä¸œ",manager:{id:"m5",name:"å°åˆ˜",contact:"13800138005",email:"xiaoliu@example.com"},institutions:[{id:"i11",name:"å—äº¬åˆ†å…¬å¸",address:"å—äº¬å¸‚é¼“æ¥¼åŒº",establishedDate:new Date("2021-07-15"),status:"active",regionId:"5"},{id:"i12",name:"è‹å·åŠäº‹å¤„",address:"è‹å·å¸‚å·¥ä¸šå›­åŒº",establishedDate:new Date("2022-02-28"),status:"active",regionId:"5"}]},{id:"6",name:"å››å·çœ",regionType:"åè¥¿",manager:{id:"m6",name:"å°é™ˆ",contact:"13800138006",email:"xiaochen@example.com"},institutions:[{id:"i13",name:"æˆéƒ½åˆ†å…¬å¸",address:"æˆéƒ½å¸‚é«˜æ–°åŒº",establishedDate:new Date("2021-10-12"),status:"active",regionId:"6"}]}],ve=s=>{if(s.length===0)return[];const t=Math.max(...s.map(r=>r.value),1),n=[];n.push({min:0,max:0,color:"#f0f0f0",label:"æ— æœºæ„"});const a=Math.min(6,t);for(let r=1;r<=a;r++){const i=Math.ceil((r-1)*t/a)+(r===1?1:0),o=r===a?void 0:Math.ceil(r*t/a);n.push({min:i,max:o,color:ye(r),label:o?`${i}-${o}å®¶`:`${i}å®¶ä»¥ä¸Š`})}return n},ye=s=>{const t=["#c6e48b","#7bc96f","#239a3b","#196127","#0d4d1a","#0a3d14"],n=Math.min(s-1,t.length-1);return t[n]},je=({data:s,onMapEvent:t,loading:n=!1,className:a=""})=>{const r=N.useRef(null),i=N.useRef(null);return N.useEffect(()=>r.current?(i.current=ue(r.current),(async()=>{try{const l=await(await fetch("https://geo.datav.aliyun.com/areas_v3/bound/100000_full.json")).json();U("china",l)}catch(c){console.warn("åœ¨çº¿åœ°å›¾åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°æ•°æ®:",c),U("china",be)}})(),()=>{var c;(c=i.current)==null||c.dispose()}):void 0,[]),N.useEffect(()=>{if(!i.current)return;setTimeout(()=>{var d,m,g,b,v;const c={title:{text:"ä¸­å›½åœ°å›¾ä»ªè¡¨ç›˜",left:"center",textStyle:{color:"#1f2329",fontSize:18,fontWeight:"bold"}},tooltip:{trigger:"item",formatter:f=>{const u=f.data;return u?`
            <div style="padding: 8px;">
              <div style="font-weight: bold; margin-bottom: 4px;">${u.name}</div>
              <div>è´Ÿè´£äºº: ${u.manager}</div>
              <div>æœºæ„æ•°é‡: ${u.value}</div>
              <div>ç®¡ç†åŒºåŸŸ: ${u.regionType}</div>
            </div>
          `:""},backgroundColor:"rgba(255, 255, 255, 0.95)",borderColor:"#e3e6ea",borderWidth:1,textStyle:{color:"#1f2329",fontSize:12}},visualMap:{type:"piecewise",pieces:ve(s),orient:"vertical",left:"left",top:"bottom",textStyle:{color:"#1f2329",fontSize:12},itemWidth:20,itemHeight:14,itemGap:5},series:[{name:"æœºæ„åˆ†å¸ƒ",type:"map",map:"china",data:s,roam:!0,scaleLimit:{min:.8,max:3},itemStyle:{borderColor:"#333",borderWidth:.5,areaColor:"#f0f0f0"},emphasis:{itemStyle:{areaColor:"#ffd700",shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.3)",borderWidth:1,borderColor:"#ff6b35"}},select:{itemStyle:{areaColor:"#ff6b35",borderWidth:1,borderColor:"#ff4500"}}}]};n?(d=i.current)==null||d.showLoading("default",{text:"åŠ è½½ä¸­...",color:"#3370ff",textColor:"#1f2329",maskColor:"rgba(255, 255, 255, 0.8)"}):(m=i.current)==null||m.hideLoading(),(g=i.current)==null||g.setOption(c,!0);const l=f=>{f.data&&t&&t({type:"click",data:{regionId:f.data.name,regionName:f.data.name,institutionCount:f.data.value,manager:f.data.manager},timestamp:Date.now()})},h=f=>{f.data&&t&&t({type:"hover",data:{regionId:f.data.name,regionName:f.data.name,institutionCount:f.data.value,manager:f.data.manager},timestamp:Date.now()})};return(b=i.current)==null||b.on("click",l),(v=i.current)==null||v.on("mouseover",h),()=>{var f,u;(f=i.current)==null||f.off("click",l),(u=i.current)==null||u.off("mouseover",h)}},100)},[s,n,t]),N.useEffect(()=>{const o=()=>{var l;(l=i.current)==null||l.resize()},c=l=>{if(i.current)switch(l.key){case"Escape":i.current.dispatchAction({type:"restore"});break;case"+":case"=":i.current.dispatchAction({type:"geoZoom",zoom:1.2});break;case"-":i.current.dispatchAction({type:"geoZoom",zoom:.8});break;case"r":case"R":i.current.dispatchAction({type:"geoRestore"});break}};return window.addEventListener("resize",o),window.addEventListener("keydown",c),()=>{window.removeEventListener("resize",o),window.removeEventListener("keydown",c)}},[]),e.jsx("div",{ref:r,className:`w-full h-full min-h-[600px] ${a}`,style:{minHeight:"600px",width:"100%",height:"100%"}})},Ne=({regions:s,selectedRegion:t,onRegionSelect:n})=>{const[a,r]=N.useState(""),[i,o]=N.useState("all"),c=Array.from(new Set(s.map(m=>m.regionType))),h=[...s.filter(m=>{const g=m.name.toLowerCase().includes(a.toLowerCase())||m.manager.name.toLowerCase().includes(a.toLowerCase()),b=i==="all"||m.regionType===i;return g&&b})].sort((m,g)=>g.institutions.length-m.institutions.length),d=s.find(m=>m.name===t);return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-feishu-primary mb-1",children:"æœç´¢åœ°åŒº"}),e.jsx("input",{type:"text",value:a,onChange:m=>r(m.target.value),placeholder:"è¾“å…¥çœä»½åç§°æˆ–è´Ÿè´£äººå§“å",className:"w-full px-3 py-2 border border-feishu-border rounded-md focus:outline-none focus:ring-2 focus:ring-feishu-accent focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-feishu-primary mb-1",children:"ç®¡ç†åŒºåŸŸ"}),e.jsxs("select",{value:i,onChange:m=>o(m.target.value),className:"w-full px-3 py-2 border border-feishu-border rounded-md focus:outline-none focus:ring-2 focus:ring-feishu-accent focus:border-transparent",children:[e.jsx("option",{value:"all",children:"å…¨éƒ¨åŒºåŸŸ"}),c.map(m=>e.jsx("option",{value:m,children:m},m))]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsx("div",{className:"px-4 pb-2",children:e.jsxs("h3",{className:"text-sm font-medium text-feishu-primary mb-2",children:["åœ°åŒºåˆ—è¡¨ (",h.length,")"]})}),e.jsx("div",{className:"space-y-1 px-4",children:h.map(m=>e.jsx("div",{onClick:()=>n(m.name===t?null:m.name),className:`p-3 rounded-md cursor-pointer transition-colors ${t===m.name?"bg-feishu-accent bg-opacity-10 border border-feishu-accent":"hover:bg-gray-50 border border-transparent"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-feishu-primary",children:m.name}),e.jsxs("div",{className:"text-sm text-feishu-secondary",children:[m.manager.name," Â· ",m.regionType]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-semibold text-feishu-accent",children:m.institutions.length}),e.jsx("div",{className:"text-xs text-feishu-secondary",children:"æœºæ„"})]})]})},m.id))}),h.length===0&&e.jsxs("div",{className:"text-center py-8 text-feishu-secondary",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ğŸ”"}),e.jsx("div",{children:"æœªæ‰¾åˆ°åŒ¹é…çš„åœ°åŒº"})]})]}),d&&e.jsxs("div",{className:"border-t border-feishu-border p-4 bg-white",children:[e.jsxs("h3",{className:"font-medium text-feishu-primary mb-3",children:[d.name," è¯¦æƒ…"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-feishu-secondary",children:"è´Ÿè´£äºº:"}),e.jsx("span",{className:"text-feishu-primary",children:d.manager.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-feishu-secondary",children:"è”ç³»æ–¹å¼:"}),e.jsx("span",{className:"text-feishu-primary",children:d.manager.contact})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-feishu-secondary",children:"ç®¡ç†åŒºåŸŸ:"}),e.jsx("span",{className:"text-feishu-primary",children:d.regionType})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-feishu-secondary",children:"æœºæ„æ€»æ•°:"}),e.jsx("span",{className:"text-feishu-accent font-semibold",children:d.institutions.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-feishu-secondary",children:"æ´»è·ƒæœºæ„:"}),e.jsx("span",{className:"text-feishu-success",children:d.institutions.filter(m=>m.status==="active").length})]})]}),e.jsx("button",{onClick:()=>n(null),className:"w-full mt-3 feishu-button feishu-button-secondary text-sm",children:"å…³é—­è¯¦æƒ…"})]})]})},T={åä¸œ:{regionType:"åä¸œ",baseColor:"#3b82f6",colorRange:["#eff6ff","#dbeafe","#bfdbfe","#93c5fd","#60a5fa","#3b82f6","#2563eb","#1d4ed8","#1e40af"],maxInstitutions:20},åå—:{regionType:"åå—",baseColor:"#ef4444",colorRange:["#fef2f2","#fee2e2","#fecaca","#fca5a5","#f87171","#ef4444","#dc2626","#b91c1c","#991b1b"],maxInstitutions:20},åè¥¿:{regionType:"åè¥¿",baseColor:"#22c55e",colorRange:["#f0fdf4","#dcfce7","#bbf7d0","#86efac","#4ade80","#22c55e","#16a34a","#15803d","#166534"],maxInstitutions:20},ååŒ—:{regionType:"ååŒ—",baseColor:"#eab308",colorRange:["#fefce8","#fef9c3","#fef08a","#fde047","#facc15","#eab308","#ca8a04","#a16207","#854d0e"],maxInstitutions:20},åä¸­:{regionType:"åä¸­",baseColor:"#8b5cf6",colorRange:["#faf5ff","#f3e8ff","#e9d5ff","#d8b4fe","#c084fc","#a855f7","#9333ea","#7c3aed","#6d28d9"],maxInstitutions:20},ä¸œåŒ—:{regionType:"ä¸œåŒ—",baseColor:"#06b6d4",colorRange:["#ecfeff","#cffafe","#a5f3fc","#67e8f9","#22d3ee","#06b6d4","#0891b2","#0e7490","#155e75"],maxInstitutions:20},è¥¿åŒ—:{regionType:"è¥¿åŒ—",baseColor:"#f59e0b",colorRange:["#fffbeb","#fef3c7","#fde68a","#fcd34d","#fbbf24","#f59e0b","#d97706","#b45309","#92400e"],maxInstitutions:20}},Q=(s,t,n)=>{const a=T[s]||T.åä¸œ,r=n||a.maxInstitutions;if(t===0)return a.colorRange[0];const i=Math.min(t/r,1),o=Math.min(Math.floor(i*(a.colorRange.length-1))+1,a.colorRange.length-1);return a.colorRange[o]},we=s=>s.length===0?1:Math.max(...s.map(t=>t.institutions.length),1),z=s=>{const t={...T},n={};return s.forEach(a=>{const r=n[a.regionType]||0;n[a.regionType]=Math.max(r,a.institutions.length)}),Object.keys(t).forEach(a=>{n[a]&&(t[a]={...t[a],maxInstitutions:Math.max(n[a],5)})}),t},Se=s=>{const{colorRange:t,maxInstitutions:n}=s,a=[];for(let r=0;r<t.length;r++){const i=r===0?0:Math.ceil((r-1)*n/(t.length-2)),o=r===0?0:Math.ceil(r*n/(t.length-2));a.push({color:t[r],label:r===0?"æ— æœºæ„":r===t.length-1?`${i}+`:i===o?`${i}`:`${i}-${o}`,value:r===0?0:o,range:{min:i,max:o}})}return a},Re=s=>{const t=T[s];return t?t.baseColor:T.åä¸œ.baseColor},Ce=({colorSchemes:s,statistics:t,updatedColorSchemes:n})=>{var r;const a={åä¸œ:"åä¸œåœ°åŒº",åå—:"åå—åœ°åŒº",åè¥¿:"åè¥¿åœ°åŒº",ååŒ—:"ååŒ—åœ°åŒº",åä¸­:"åä¸­åœ°åŒº",ä¸œåŒ—:"ä¸œåŒ—åœ°åŒº",è¥¿åŒ—:"è¥¿åŒ—åœ°åŒº"};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-feishu-accent",children:t.totalRegions}),e.jsx("div",{className:"text-sm text-feishu-secondary",children:"æ€»åœ°åŒºæ•°"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-feishu-success",children:t.totalInstitutions}),e.jsx("div",{className:"text-sm text-feishu-secondary",children:"æ€»æœºæ„æ•°"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-feishu-warning",children:t.activeRegions}),e.jsx("div",{className:"text-sm text-feishu-secondary",children:"æ´»è·ƒåœ°åŒº"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-feishu-primary truncate",children:((r=t.topRegion)==null?void 0:r.name)||"-"}),e.jsx("div",{className:"text-sm text-feishu-secondary",children:"æœºæ„æœ€å¤š"})]})]}),e.jsx("div",{className:"space-y-4",children:s.map(i=>{const o=n[i];if(!o)return null;const c=Se(o),l=a[i]||i;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm font-medium text-feishu-primary",children:[l," (æœ€å¤š ",o.maxInstitutions," å®¶æœºæ„)"]}),e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:c.map((h,d)=>e.jsxs("div",{className:"flex items-center space-x-1 px-2 py-1 rounded-md bg-gray-50",children:[e.jsx("div",{className:"w-4 h-4 rounded border border-gray-300",style:{backgroundColor:h.color},title:`${h.label} æœºæ„`}),e.jsx("span",{className:"text-xs text-feishu-secondary",children:h.label})]},d))})]},i)})}),e.jsx("div",{className:"text-xs text-feishu-secondary bg-feishu-background p-3 rounded-md",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("div",{className:"text-feishu-accent",children:"ğŸ’¡"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium mb-1",children:"ä½¿ç”¨è¯´æ˜:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"â€¢ é¢œè‰²æ·±æµ…ä»£è¡¨è¯¥åœ°åŒºçš„æœºæ„æ•°é‡ï¼Œé¢œè‰²è¶Šæ·±è¡¨ç¤ºæœºæ„è¶Šå¤š"}),e.jsx("li",{children:"â€¢ ç‚¹å‡»åœ°å›¾ä¸Šçš„çœä»½å¯æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯"}),e.jsx("li",{children:"â€¢ ä½¿ç”¨å³ä¾§æ§åˆ¶é¢æ¿å¯ä»¥æœç´¢å’Œç­›é€‰åœ°åŒº"}),e.jsx("li",{children:"â€¢ æ”¯æŒé¼ æ ‡æ»šè½®ç¼©æ”¾å’Œæ‹–æ‹½ç§»åŠ¨åœ°å›¾"})]})]})]})})]})},J=s=>{const t=s.flatMap(o=>o.institutions),n=t.filter(o=>o.status==="active"),a=t.filter(o=>o.status==="inactive"),r=s.reduce((o,c)=>{const l=c.regionType;return o[l]||(o[l]={institutionCount:0,managerCount:0}),o[l].institutionCount+=c.institutions.length,o[l].managerCount+=1,o},{}),i=s.reduce((o,c)=>c.institutions.length>o.institutions.length?c:o,s[0]||{institutions:[],name:"",manager:{name:""}});return{totalRegions:s.length,totalInstitutions:t.length,activeInstitutions:n.length,inactiveInstitutions:a.length,totalManagers:s.length,activeRegions:s.filter(o=>o.institutions.length>0).length,topRegion:{name:i.name,institutions:{length:i.institutions.length},manager:{name:i.manager.name}},regionStats:r}},Ie=(s,t,n="asc")=>[...s].sort((r,i)=>{let o=0;switch(t){case"name":o=r.name.localeCompare(i.name,"zh-CN");break;case"institutionCount":o=r.institutions.length-i.institutions.length;break;case"manager":o=r.manager.name.localeCompare(i.manager.name,"zh-CN");break}return n==="desc"?-o:o}),ee=s=>new Date(s).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}),De=({region:s,isOpen:t,onClose:n})=>{const[a,r]=N.useState("overview");if(!t||!s)return null;const i=Re(s.regionType),o=s.institutions.filter(l=>l.status==="active"),c=s.institutions.filter(l=>l.status==="inactive");return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 text-white relative",style:{backgroundColor:i},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:s.name}),e.jsxs("p",{className:"text-white text-opacity-90 mt-1",children:[s.regionType," Â· ",s.manager.name," è´Ÿè´£"]})]}),e.jsx("button",{onClick:n,className:"text-white hover:text-gray-200 text-2xl font-bold w-8 h-8 flex items-center justify-center rounded-full hover:bg-white hover:bg-opacity-20 transition-colors",children:"Ã—"})]})}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"flex space-x-8 px-6",children:[{key:"overview",label:"æ¦‚è§ˆ",icon:"ğŸ“Š"},{key:"institutions",label:"æœºæ„åˆ—è¡¨",icon:"ğŸ¢"},{key:"manager",label:"è´Ÿè´£äººä¿¡æ¯",icon:"ğŸ‘¤"}].map(l=>e.jsxs("button",{onClick:()=>r(l.key),className:`py-3 px-1 border-b-2 font-medium text-sm transition-colors ${a===l.key?"border-feishu-accent text-feishu-accent":"border-transparent text-feishu-secondary hover:text-feishu-primary hover:border-gray-300"}`,children:[e.jsx("span",{className:"mr-2",children:l.icon}),l.label]},l.key))})}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:[a==="overview"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:s.institutions.length}),e.jsx("div",{className:"text-sm text-blue-800",children:"æ€»æœºæ„æ•°"})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:o.length}),e.jsx("div",{className:"text-sm text-green-800",children:"æ´»è·ƒæœºæ„"})]}),e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:c.length}),e.jsx("div",{className:"text-sm text-red-800",children:"åœç”¨æœºæ„"})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[Math.round(o.length/s.institutions.length*100)||0,"%"]}),e.jsx("div",{className:"text-sm text-purple-800",children:"æ´»è·ƒç‡"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-feishu-primary mb-3",children:"æœ€æ–°æˆç«‹æœºæ„"}),e.jsx("div",{className:"space-y-2",children:s.institutions.sort((l,h)=>new Date(h.establishedDate).getTime()-new Date(l.establishedDate).getTime()).slice(0,3).map(l=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-feishu-primary",children:l.name}),e.jsx("div",{className:"text-sm text-feishu-secondary",children:l.address})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-feishu-secondary",children:ee(l.establishedDate)}),e.jsx("div",{className:`text-xs px-2 py-1 rounded-full ${l.status==="active"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:l.status==="active"?"æ´»è·ƒ":"åœç”¨"})]})]},l.id))})]})]}),a==="institutions"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold text-feishu-primary",children:["æœºæ„åˆ—è¡¨ (",s.institutions.length,")"]}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs("span",{className:"text-sm text-feishu-secondary",children:["æ´»è·ƒ: ",o.length," | åœç”¨: ",c.length]})})]}),e.jsx("div",{className:"space-y-3",children:s.institutions.map(l=>e.jsx(ke,{institution:l},l.id))})]}),a==="manager"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center text-2xl",children:"ğŸ‘¤"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-semibold text-feishu-primary",children:s.manager.name}),e.jsxs("p",{className:"text-feishu-secondary mt-1",children:[s.regionType,"è´Ÿè´£äºº"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-feishu-primary",children:"è”ç³»ä¿¡æ¯"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-feishu-secondary",children:"ğŸ“"}),e.jsx("span",{children:s.manager.contact})]}),s.manager.email&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-feishu-secondary",children:"ğŸ“§"}),e.jsx("span",{children:s.manager.email})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-feishu-primary",children:"ç®¡ç†ç»Ÿè®¡"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-feishu-secondary",children:"ç®¡ç†åœ°åŒº:"}),e.jsx("span",{children:s.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-feishu-secondary",children:"æœºæ„æ€»æ•°:"}),e.jsx("span",{className:"font-semibold",children:s.institutions.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-feishu-secondary",children:"æ´»è·ƒæœºæ„:"}),e.jsx("span",{className:"text-green-600 font-semibold",children:o.length})]})]})]})]})]})]}),e.jsx("div",{className:"px-6 py-4 bg-gray-50 border-t border-gray-200 flex justify-end",children:e.jsx("button",{onClick:n,className:"feishu-button feishu-button-primary",children:"å…³é—­"})})]})})},ke=({institution:s})=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h4",{className:"font-medium text-feishu-primary",children:s.name}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${s.status==="active"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.status==="active"?"æ´»è·ƒ":"åœç”¨"})]}),e.jsxs("p",{className:"text-sm text-feishu-secondary mt-1",children:["ğŸ“ ",s.address]}),e.jsxs("p",{className:"text-sm text-feishu-secondary mt-1",children:["ğŸ“… æˆç«‹äº ",ee(s.establishedDate)]}),s.description&&e.jsx("p",{className:"text-sm text-feishu-secondary mt-2",children:s.description})]})})}),Te=({onZoomIn:s,onZoomOut:t,onReset:n,onToggleFullscreen:a,isFullscreen:r})=>e.jsxs("div",{className:"absolute top-4 right-4 bg-white rounded-lg shadow-feishu border border-feishu-border p-2 space-y-1 z-10",children:[e.jsx("button",{onClick:s,className:"w-8 h-8 flex items-center justify-center hover:bg-gray-100 rounded text-feishu-primary transition-colors",title:"æ”¾å¤§ (+)",children:"ğŸ”+"}),e.jsx("button",{onClick:t,className:"w-8 h-8 flex items-center justify-center hover:bg-gray-100 rounded text-feishu-primary transition-colors",title:"ç¼©å° (-)",children:"ğŸ”-"}),e.jsx("button",{onClick:n,className:"w-8 h-8 flex items-center justify-center hover:bg-gray-100 rounded text-feishu-primary transition-colors",title:"é‡ç½®è§†å›¾ (R)",children:"ğŸ "}),e.jsx("div",{className:"border-t border-feishu-border my-1"}),e.jsx("button",{onClick:a,className:"w-8 h-8 flex items-center justify-center hover:bg-gray-100 rounded text-feishu-primary transition-colors",title:r?"é€€å‡ºå…¨å±":"å…¨å±æ˜¾ç¤º",children:r?"â¤“":"â¤¢"})]}),G=s=>{let t;const n=new Set,a=(d,m)=>{const g=typeof d=="function"?d(t):d;if(!Object.is(g,t)){const b=t;t=m??(typeof g!="object"||g===null)?g:Object.assign({},t,g),n.forEach(v=>v(t,b))}},r=()=>t,l={setState:a,getState:r,getInitialState:()=>h,subscribe:d=>(n.add(d),()=>n.delete(d)),destroy:()=>{n.clear()}},h=t=s(a,r,l);return l},Ee=s=>s?G(s):G;var te={exports:{}},se={},ne={exports:{}},ae={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var I=N;function Me(s,t){return s===t&&(s!==0||1/s===1/t)||s!==s&&t!==t}var Oe=typeof Object.is=="function"?Object.is:Me,_e=I.useState,Le=I.useEffect,Pe=I.useLayoutEffect,Ae=I.useDebugValue;function $e(s,t){var n=t(),a=_e({inst:{value:n,getSnapshot:t}}),r=a[0].inst,i=a[1];return Pe(function(){r.value=n,r.getSnapshot=t,P(r)&&i({inst:r})},[s,n,t]),Le(function(){return P(r)&&i({inst:r}),s(function(){P(r)&&i({inst:r})})},[s]),Ae(n),n}function P(s){var t=s.getSnapshot;s=s.value;try{var n=t();return!Oe(s,n)}catch{return!0}}function ze(s,t){return t()}var Fe=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?ze:$e;ae.useSyncExternalStore=I.useSyncExternalStore!==void 0?I.useSyncExternalStore:Fe;ne.exports=ae;var Be=ne.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _=N,Ue=Be;function We(s,t){return s===t&&(s!==0||1/s===1/t)||s!==s&&t!==t}var He=typeof Object.is=="function"?Object.is:We,Je=Ue.useSyncExternalStore,Ge=_.useRef,Ve=_.useEffect,Ze=_.useMemo,qe=_.useDebugValue;se.useSyncExternalStoreWithSelector=function(s,t,n,a,r){var i=Ge(null);if(i.current===null){var o={hasValue:!1,value:null};i.current=o}else o=i.current;i=Ze(function(){function l(b){if(!h){if(h=!0,d=b,b=a(b),r!==void 0&&o.hasValue){var v=o.value;if(r(v,b))return m=v}return m=b}if(v=m,He(d,b))return v;var f=a(b);return r!==void 0&&r(v,f)?(d=b,v):(d=b,m=f)}var h=!1,d,m,g=n===void 0?null:n;return[function(){return l(t())},g===null?void 0:function(){return l(g())}]},[t,n,a,r]);var c=Je(s,i[0],i[1]);return Ve(function(){o.hasValue=!0,o.value=c},[c]),qe(c),c};te.exports=se;var Xe=te.exports;const Ke=de(Xe),{useDebugValue:Ye}=X,{useSyncExternalStoreWithSelector:Qe}=Ke;const et=s=>s;function tt(s,t=et,n){const a=Qe(s.subscribe,s.getState,s.getServerState||s.getInitialState,t,n);return Ye(a),a}const V=s=>{const t=typeof s=="function"?Ee(s):s,n=(a,r)=>tt(t,a,r);return Object.assign(n,t),n},st=s=>s?V(s):V,F=new Map,M=s=>{const t=F.get(s);return t?Object.fromEntries(Object.entries(t.stores).map(([n,a])=>[n,a.getState()])):{}},nt=(s,t,n)=>{if(s===void 0)return{type:"untracked",connection:t.connect(n)};const a=F.get(n.name);if(a)return{type:"tracked",store:s,...a};const r={connection:t.connect(n),stores:{}};return F.set(n.name,r),{type:"tracked",store:s,...r}},at=(s,t={})=>(n,a,r)=>{const{enabled:i,anonymousActionType:o,store:c,...l}=t;let h;try{h=(i??!1)&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!h)return s(n,a,r);const{connection:d,...m}=nt(c,h,l);let g=!0;r.setState=(f,u,x)=>{const p=n(f,u);if(!g)return p;const j=x===void 0?{type:o||"anonymous"}:typeof x=="string"?{type:x}:x;return c===void 0?(d==null||d.send(j,a()),p):(d==null||d.send({...j,type:`${c}/${j.type}`},{...M(l.name),[c]:r.getState()}),p)};const b=(...f)=>{const u=g;g=!1,n(...f),g=u},v=s(r.setState,a,r);if(m.type==="untracked"?d==null||d.init(v):(m.stores[m.store]=r,d==null||d.init(Object.fromEntries(Object.entries(m.stores).map(([f,u])=>[f,f===m.store?v:u.getState()])))),r.dispatchFromDevtools&&typeof r.dispatch=="function"){let f=!1;const u=r.dispatch;r.dispatch=(...x)=>{u(...x)}}return d.subscribe(f=>{var u;switch(f.type){case"ACTION":if(typeof f.payload!="string"){console.error("[zustand devtools middleware] Unsupported action format");return}return A(f.payload,x=>{if(x.type==="__setState"){if(c===void 0){b(x.state);return}Object.keys(x.state).length!==1&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format. 
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);const p=x.state[c];if(p==null)return;JSON.stringify(r.getState())!==JSON.stringify(p)&&b(p);return}r.dispatchFromDevtools&&typeof r.dispatch=="function"&&r.dispatch(x)});case"DISPATCH":switch(f.payload.type){case"RESET":return b(v),c===void 0?d==null?void 0:d.init(r.getState()):d==null?void 0:d.init(M(l.name));case"COMMIT":if(c===void 0){d==null||d.init(r.getState());return}return d==null?void 0:d.init(M(l.name));case"ROLLBACK":return A(f.state,x=>{if(c===void 0){b(x),d==null||d.init(r.getState());return}b(x[c]),d==null||d.init(M(l.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return A(f.state,x=>{if(c===void 0){b(x);return}JSON.stringify(r.getState())!==JSON.stringify(x[c])&&b(x[c])});case"IMPORT_STATE":{const{nextLiftedState:x}=f.payload,p=(u=x.computedStates.slice(-1)[0])==null?void 0:u.state;if(!p)return;b(c===void 0?p:p[c]),d==null||d.send(null,x);return}case"PAUSE_RECORDING":return g=!g}return}}),v},rt=at,A=(s,t)=>{let n;try{n=JSON.parse(s)}catch(a){console.error("[zustand devtools middleware] Could not parse the received json",a)}n!==void 0&&t(n)};function it(s,t){let n;try{n=s()}catch{return}return{getItem:r=>{var i;const o=l=>l===null?null:JSON.parse(l,t==null?void 0:t.reviver),c=(i=n.getItem(r))!=null?i:null;return c instanceof Promise?c.then(o):o(c)},setItem:(r,i)=>n.setItem(r,JSON.stringify(i,t==null?void 0:t.replacer)),removeItem:r=>n.removeItem(r)}}const E=s=>t=>{try{const n=s(t);return n instanceof Promise?n:{then(a){return E(a)(n)},catch(a){return this}}}catch(n){return{then(a){return this},catch(a){return E(a)(n)}}}},ot=(s,t)=>(n,a,r)=>{let i={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:u=>u,version:0,merge:(u,x)=>({...x,...u}),...t},o=!1;const c=new Set,l=new Set;let h;try{h=i.getStorage()}catch{}if(!h)return s((...u)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),n(...u)},a,r);const d=E(i.serialize),m=()=>{const u=i.partialize({...a()});let x;const p=d({state:u,version:i.version}).then(j=>h.setItem(i.name,j)).catch(j=>{x=j});if(x)throw x;return p},g=r.setState;r.setState=(u,x)=>{g(u,x),m()};const b=s((...u)=>{n(...u),m()},a,r);let v;const f=()=>{var u;if(!h)return;o=!1,c.forEach(p=>p(a()));const x=((u=i.onRehydrateStorage)==null?void 0:u.call(i,a()))||void 0;return E(h.getItem.bind(h))(i.name).then(p=>{if(p)return i.deserialize(p)}).then(p=>{if(p)if(typeof p.version=="number"&&p.version!==i.version){if(i.migrate)return i.migrate(p.state,p.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return p.state}).then(p=>{var j;return v=i.merge(p,(j=a())!=null?j:b),n(v,!0),m()}).then(()=>{x==null||x(v,void 0),o=!0,l.forEach(p=>p(v))}).catch(p=>{x==null||x(void 0,p)})};return r.persist={setOptions:u=>{i={...i,...u},u.getStorage&&(h=u.getStorage())},clearStorage:()=>{h==null||h.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>f(),hasHydrated:()=>o,onHydrate:u=>(c.add(u),()=>{c.delete(u)}),onFinishHydration:u=>(l.add(u),()=>{l.delete(u)})},f(),v||b},lt=(s,t)=>(n,a,r)=>{let i={storage:it(()=>localStorage),partialize:f=>f,version:0,merge:(f,u)=>({...u,...f}),...t},o=!1;const c=new Set,l=new Set;let h=i.storage;if(!h)return s((...f)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),n(...f)},a,r);const d=()=>{const f=i.partialize({...a()});return h.setItem(i.name,{state:f,version:i.version})},m=r.setState;r.setState=(f,u)=>{m(f,u),d()};const g=s((...f)=>{n(...f),d()},a,r);r.getInitialState=()=>g;let b;const v=()=>{var f,u;if(!h)return;o=!1,c.forEach(p=>{var j;return p((j=a())!=null?j:g)});const x=((u=i.onRehydrateStorage)==null?void 0:u.call(i,(f=a())!=null?f:g))||void 0;return E(h.getItem.bind(h))(i.name).then(p=>{if(p)if(typeof p.version=="number"&&p.version!==i.version){if(i.migrate)return[!0,i.migrate(p.state,p.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,p.state];return[!1,void 0]}).then(p=>{var j;const[D,L]=p;if(b=i.merge(L,(j=a())!=null?j:g),n(b,!0),D)return d()}).then(()=>{x==null||x(b,void 0),b=a(),o=!0,l.forEach(p=>p(b))}).catch(p=>{x==null||x(void 0,p)})};return r.persist={setOptions:f=>{i={...i,...f},f.storage&&(h=f.storage)},clearStorage:()=>{h==null||h.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>v(),hasHydrated:()=>o,onHydrate:f=>(c.add(f),()=>{c.delete(f)}),onFinishHydration:f=>(l.add(f),()=>{l.delete(f)})},i.skipHydration||v(),b||g},ct=(s,t)=>"getStorage"in t||"serialize"in t||"deserialize"in t?ot(s,t):lt(s,t),dt=ct;class ut{constructor(t,n,a){w(this,"appToken");w(this,"tableId");w(this,"accessToken");w(this,"baseUrl","https://open.feishu.cn/open-apis/bitable/v1");this.appToken=t,this.tableId=n,this.accessToken=a}async getInstitutionRecords(){try{const t=await fetch(`${this.baseUrl}/apps/${this.appToken}/tables/${this.tableId}/records?page_size=100`,{method:"GET",headers:{Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`è·å–å¤šç»´è¡¨æ ¼æ•°æ®å¤±è´¥: ${t.statusText}`);return(await t.json()).data.items||[]}catch(t){throw console.error("è·å–å¤šç»´è¡¨æ ¼æ•°æ®å¤±è´¥:",t),t}}isValidRecord(t){const n=t.fields;return!!(n.æœºæ„åç§°&&n.æœºæ„åç§°.trim()!==""&&n.æ‰€å±çœä»½&&n.æ‰€å±çœä»½.trim()!==""&&n.ç®¡ç†åŒºåŸŸ&&n.ç®¡ç†åŒºåŸŸ.trim()!=="")}standardizeRecord(t){const n=t.fields;return{record_id:t.record_id,fields:{æœºæ„åç§°:n.æœºæ„åç§°||"æœªå‘½åæœºæ„",æœºæ„åœ°å€:n.æœºæ„åœ°å€||`${n.æ‰€å±çœä»½||"æœªçŸ¥çœä»½"}åœ°åŒº`,æ‰€å±çœä»½:n.æ‰€å±çœä»½||"æœªçŸ¥çœä»½",ç®¡ç†åŒºåŸŸ:n.ç®¡ç†åŒºåŸŸ||"æœªåˆ†ç±»",è´Ÿè´£äºº:n.è´Ÿè´£äºº||"æœªæŒ‡å®š",è´Ÿè´£äººè”ç³»æ–¹å¼:n.è´Ÿè´£äººè”ç³»æ–¹å¼||"è”ç³»æ–¹å¼å¾…è¡¥å……",è´Ÿè´£äººé‚®ç®±:n.è´Ÿè´£äººé‚®ç®±||"",æˆç«‹æ—¥æœŸ:n.æˆç«‹æ—¥æœŸ||"2023-01-01",çŠ¶æ€:n.çŠ¶æ€||"æ´»è·ƒ",å¤‡æ³¨:n.å¤‡æ³¨||""}}}async getManagerRecords(){return[]}transformToRegionData(t,n=[],a){const r=t.filter(h=>this.isValidRecord(h)),i=r.map(h=>this.standardizeRecord(h));console.log(`ğŸ“Š æ•°æ®å¤„ç†: åŸå§‹${t.length}æ¡ â†’ æœ‰æ•ˆ${r.length}æ¡ â†’ æ ‡å‡†åŒ–${i.length}æ¡`);const o=i.reduce((h,d)=>{const m=d.fields.æ‰€å±çœä»½;return h[m]||(h[m]=[]),h[m].push(d),h},{}),c=n.reduce((h,d)=>{const m=d.fields.ç®¡ç†åŒºåŸŸ;return h[m]=d,h},{}),l=[];return Object.entries(o).forEach(([h,d])=>{var u;if(d.length===0||!h||h==="æœªçŸ¥çœä»½")return;let m;a?m=((u=Object.entries(a).find(([,x])=>x.includes(h)))==null?void 0:u[0])||"æœªåˆ†é…":m=d[0].fields.ç®¡ç†åŒºåŸŸ;const g=c[m],b=d[0].fields.è´Ÿè´£äºº,v=d.map(x=>({id:x.record_id,name:x.fields.æœºæ„åç§°,address:x.fields.æœºæ„åœ°å€,establishedDate:new Date(x.fields.æˆç«‹æ—¥æœŸ),status:x.fields.çŠ¶æ€==="æ´»è·ƒ"?"active":"inactive",regionId:h,description:x.fields.å¤‡æ³¨})),f={id:h,name:h,regionType:m,manager:{id:(g==null?void 0:g.record_id)||`manager_${m}`,name:(g==null?void 0:g.fields.è´Ÿè´£äººå§“å)||b,contact:(g==null?void 0:g.fields.è”ç³»ç”µè¯)||d[0].fields.è´Ÿè´£äººè”ç³»æ–¹å¼,email:(g==null?void 0:g.fields.é‚®ç®±åœ°å€)||d[0].fields.è´Ÿè´£äººé‚®ç®±,avatar:g==null?void 0:g.fields.å¤´åƒ},institutions:v};l.push(f)}),l}async subscribeToChanges(t){const a=async()=>{try{const r=await this.getInstitutionRecords(),i=await this.getManagerRecords(),o=this.transformToRegionData(r,i);t(o)}catch(r){console.error("è½®è¯¢æ•°æ®å¤±è´¥:",r)}};await a(),setInterval(a,3e4)}async updateInstitutionStatus(t,n){try{const a=await fetch(`${this.baseUrl}/apps/${this.appToken}/tables/${this.tableId}/records/${t}`,{method:"PUT",headers:{Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json"},body:JSON.stringify({fields:{çŠ¶æ€:n}})});if(!a.ok)throw new Error(`æ›´æ–°è®°å½•å¤±è´¥: ${a.statusText}`)}catch(a){throw console.error("æ›´æ–°å¤šç»´è¡¨æ ¼è®°å½•å¤±è´¥:",a),a}}async addInstitution(t){try{const n=await fetch(`${this.baseUrl}/apps/${this.appToken}/tables/${this.tableId}/records`,{method:"POST",headers:{Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json"},body:JSON.stringify({fields:{æœºæ„åç§°:t.name,æœºæ„åœ°å€:t.address,æ‰€å±çœä»½:t.province,ç®¡ç†åŒºåŸŸ:t.regionType,è´Ÿè´£äºº:t.manager,è´Ÿè´£äººè”ç³»æ–¹å¼:t.contact,è´Ÿè´£äººé‚®ç®±:t.email,æˆç«‹æ—¥æœŸ:t.establishedDate.toISOString().split("T")[0],çŠ¶æ€:t.status,å¤‡æ³¨:t.description}})});if(!n.ok)throw new Error(`æ·»åŠ è®°å½•å¤±è´¥: ${n.statusText}`);return(await n.json()).data.record.record_id}catch(n){throw console.error("æ·»åŠ å¤šç»´è¡¨æ ¼è®°å½•å¤±è´¥:",n),n}}}const ht=(s,t)=>s.map(n=>{var r;const a=(r=Object.entries(t).find(([,i])=>i.includes(n.name)))==null?void 0:r[0];return a&&a!==n.regionType?{...n,regionType:a}:n}),mt={regions:[],colorSchemes:{},statistics:null,selectedRegion:null,hoveredRegion:null,showControls:!0,showDetailModal:!1,isFullscreen:!1,filterOptions:{},searchTerm:"",sortBy:"name",sortOrder:"asc",loadingState:{isLoading:!1,error:null,lastUpdated:null},userProfile:null,bitableConfig:{appToken:"PGuTbyauXavdl7s8Jpec2lUAnah",tableId:"tblLawFGl4bUcqHA",accessToken:"t-g10495bGB7VY3MTCZ2IWG6WD7DUIX74OD2RLW26I"},dataSource:"bitable",regionMapping:null},S=st()(rt(dt((s,t)=>({...mt,loadRegions:async()=>{const{dataSource:n,bitableConfig:a,regionMapping:r}=t();s(i=>({loadingState:{...i.loadingState,isLoading:!0,error:null}}));try{let i;if(n==="bitable"&&a){const l=new ut(a.appToken,a.tableId,a.accessToken),h=await l.getInstitutionRecords(),d=await l.getManagerRecords();i=l.transformToRegionData(h,d,r)}else await new Promise(l=>setTimeout(l,1e3)),i=r?ht(H,r):H;const o=z(i),c=J(i);s({regions:i,colorSchemes:o,statistics:c,loadingState:{isLoading:!1,error:null,lastUpdated:Date.now()}})}catch(i){s(o=>({loadingState:{...o.loadingState,isLoading:!1,error:{code:"LOAD_ERROR",message:i instanceof Error?i.message:"åŠ è½½æ•°æ®å¤±è´¥",details:i instanceof Error?{message:i.message}:void 0,timestamp:Date.now()}}}))}},loadFromBitable:async n=>{s({bitableConfig:n,dataSource:"bitable"});const{loadRegions:a}=t();await a()},updateRegion:(n,a)=>{s(r=>{const i=r.regions.map(o=>o.id===n?{...o,...a}:o);return{regions:i,statistics:J(i),colorSchemes:z(i)}})},refreshData:async()=>{const{loadRegions:n}=t();await n()},switchDataSource:n=>{s({dataSource:n})},setSelectedRegion:n=>{const a=n?t().regions.find(r=>r.id===n||r.name===n):null;s({selectedRegion:a})},setHoveredRegion:n=>{s({hoveredRegion:n})},toggleControls:()=>{s(n=>({showControls:!n.showControls}))},toggleDetailModal:n=>{s(a=>({showDetailModal:n!==void 0?n:!a.showDetailModal}))},toggleFullscreen:()=>{s(n=>({isFullscreen:!n.isFullscreen}))},setFilterOptions:n=>{s(a=>({filterOptions:{...a.filterOptions,...n}}))},setSearchTerm:n=>{s({searchTerm:n})},setSorting:(n,a="asc")=>{s({sortBy:n,sortOrder:a})},clearFilters:()=>{s({filterOptions:{},searchTerm:"",sortBy:"name",sortOrder:"asc"})},getFilteredRegions:()=>{const{regions:n,filterOptions:a,searchTerm:r,sortBy:i,sortOrder:o}=t();let c=n;return r&&(c=c.filter(l=>l.name.toLowerCase().includes(r.toLowerCase())||l.manager.name.toLowerCase().includes(r.toLowerCase())||l.regionType.toLowerCase().includes(r.toLowerCase()))),a.regionTypes&&a.regionTypes.length>0&&(c=c.filter(l=>a.regionTypes.includes(l.regionType))),a.managerIds&&a.managerIds.length>0&&(c=c.filter(l=>a.managerIds.includes(l.manager.id))),a.institutionStatus&&a.institutionStatus.length>0&&(c=c.filter(l=>l.institutions.some(h=>a.institutionStatus.includes(h.status)))),a.dateRange&&(c=c.filter(l=>l.institutions.some(h=>{const d=new Date(h.establishedDate);return d>=a.dateRange.start&&d<=a.dateRange.end}))),Ie(c,i,o)},getRegionColor:(n,a)=>{const{colorSchemes:r}=t(),i=Math.max(...Object.values(r).map(o=>o.maxInstitutions),1);return Q(n,a,i)},setUserProfile:n=>{s({userProfile:n})},setError:n=>{s(a=>({loadingState:{...a.loadingState,error:n?{code:"GENERAL_ERROR",message:n,details:void 0,timestamp:Date.now()}:null}}))},clearError:()=>{s(n=>({loadingState:{...n.loadingState,error:null}}))},setRegionMapping:n=>{s({regionMapping:n})},getProvinceRegion:n=>{const{regionMapping:a}=t();if(!a)return null;for(const[r,i]of Object.entries(a))if(i.includes(n))return r;return null}}),{name:"map-store",partialize:s=>({showControls:s.showControls,filterOptions:s.filterOptions,sortBy:s.sortBy,sortOrder:s.sortOrder,userProfile:s.userProfile,regionMapping:s.regionMapping})}),{name:"map-store"})),ft=()=>S(s=>s.regions),xt=()=>S(s=>s.selectedRegion),gt=()=>S(s=>s.loadingState),re=()=>S(s=>s.statistics),pt=()=>S(s=>({showControls:s.showControls,showDetailModal:s.showDetailModal,isFullscreen:s.isFullscreen,hoveredRegion:s.hoveredRegion})),ie=()=>S(s=>({loadRegions:s.loadRegions,setSelectedRegion:s.setSelectedRegion,setHoveredRegion:s.setHoveredRegion,toggleControls:s.toggleControls,toggleDetailModal:s.toggleDetailModal,toggleFullscreen:s.toggleFullscreen,setFilterOptions:s.setFilterOptions,setSearchTerm:s.setSearchTerm,setSorting:s.setSorting,clearFilters:s.clearFilters,refreshData:s.refreshData,setError:s.setError,clearError:s.clearError})),bt=({regions:s,loading:t=!1,onRegionSelect:n})=>{const a=xt(),{showControls:r,showDetailModal:i,isFullscreen:o,hoveredRegion:c}=pt(),l=re(),{setSelectedRegion:h,setHoveredRegion:d,toggleControls:m,toggleDetailModal:g,toggleFullscreen:b}=ie(),v=we(s),f=z(s),u=s.map(y=>({name:y.name,value:y.institutions.length,regionType:y.regionType,manager:y.manager.name,itemStyle:{color:Q(y.regionType,y.institutions.length,v)}})),x=y=>{switch(y.type){case"click":h(y.data.regionId),g(!0),n==null||n(y.data.regionId);break;case"hover":d(y.data.regionId);break}},p=()=>{console.log("Zoom in")},j=()=>{console.log("Zoom out")},D=()=>{console.log("Reset view")},L=l||{totalRegions:s.length,totalInstitutions:s.reduce((y,R)=>y+R.institutions.length,0),activeRegions:s.filter(y=>y.institutions.length>0).length,topRegion:s.reduce((y,R)=>R.institutions.length>y.institutions.length?R:y,s[0]||{institutions:[],name:"",manager:{name:""}})};return e.jsxs("div",{className:"relative w-full h-full bg-white rounded-lg shadow-feishu",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-feishu-border",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-feishu-primary",children:"ä¸­å›½åœ°å›¾ä»ªè¡¨ç›˜"}),e.jsxs("p",{className:"text-sm text-feishu-secondary mt-1",children:["å…± ",(l==null?void 0:l.totalRegions)||s.length," ä¸ªåœ°åŒºï¼Œ",(l==null?void 0:l.totalInstitutions)||s.reduce((y,R)=>y+R.institutions.length,0)," å®¶æœºæ„"]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("button",{onClick:m,className:"feishu-button feishu-button-secondary text-sm",children:r?"éšè—æ§åˆ¶":"æ˜¾ç¤ºæ§åˆ¶"})})]}),e.jsxs("div",{className:"relative flex h-[700px]",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(je,{data:u,onMapEvent:x,loading:t,className:"w-full h-full"}),e.jsx(Te,{onZoomIn:p,onZoomOut:j,onReset:D,onToggleFullscreen:b,isFullscreen:o}),c&&!i&&e.jsx("div",{className:"absolute top-4 left-4 bg-white rounded-lg shadow-feishu border border-feishu-border p-3 z-10",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium text-feishu-primary",children:c}),e.jsx("div",{className:"text-feishu-secondary",children:"ç‚¹å‡»æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯"})]})}),t&&e.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-80 flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-feishu-accent"}),e.jsx("span",{className:"text-feishu-secondary",children:"åŠ è½½åœ°å›¾æ•°æ®..."})]})})]}),r&&e.jsx("div",{className:"w-80 border-l border-feishu-border bg-feishu-background",children:e.jsx(Ne,{regions:s,selectedRegion:(a==null?void 0:a.name)||null,onRegionSelect:y=>h(y)})})]}),e.jsx("div",{className:"p-4 border-t border-feishu-border",children:e.jsx(Ce,{colorSchemes:Object.keys(s.reduce((y,R)=>(y[R.regionType]=!0,y),{})),statistics:L,updatedColorSchemes:f})}),e.jsx(De,{region:a,isOpen:i,onClose:()=>{g(!1),h(null)}})]})},vt=({isOpen:s,onClose:t})=>{const{dataSource:n,bitableConfig:a,loadFromBitable:r,switchDataSource:i}=S(),[o,c]=N.useState({appToken:(a==null?void 0:a.appToken)||"PGuTbyauXavdl7s8Jpec2lUAnah",tableId:(a==null?void 0:a.tableId)||"tblLawFGl4bUcqHA",accessToken:(a==null?void 0:a.accessToken)||"t-g10495bGB7VY3MTCZ2IWG6WD7DUIX74OD2RLW26I"}),[l,h]=N.useState(!1);if(!s)return null;const d=async g=>{g.preventDefault(),h(!0);try{await r(o),t()}catch(b){console.error("è¿æ¥å¤šç»´è¡¨æ ¼å¤±è´¥:",b),alert("è¿æ¥å¤šç»´è¡¨æ ¼å¤±è´¥ï¼Œè¯·æ£€æŸ¥é…ç½®ä¿¡æ¯")}finally{h(!1)}},m=()=>{i("mock"),t()};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-feishu-primary",children:"æ•°æ®æºé…ç½®"}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 text-2xl font-bold",children:"Ã—"})]})}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-blue-600",children:"ğŸ“Š"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-blue-800",children:["å½“å‰æ•°æ®æº: ",n==="bitable"?"é£ä¹¦å¤šç»´è¡¨æ ¼":"æ¼”ç¤ºæ•°æ®"]}),n==="bitable"&&a&&e.jsxs("div",{className:"text-sm text-blue-600 mt-1",children:["è¡¨æ ¼ID: ",a.tableId]})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-feishu-primary",children:"é€‰æ‹©æ•°æ®æº"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center",children:"ğŸ­"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-feishu-primary",children:"æ¼”ç¤ºæ•°æ®"}),e.jsx("p",{className:"text-sm text-feishu-secondary",children:"ä½¿ç”¨å†…ç½®çš„ç¤ºä¾‹æ•°æ®"})]})]}),e.jsx("button",{onClick:m,className:"w-full mt-3 feishu-button feishu-button-secondary",disabled:n==="mock",children:n==="mock"?"å½“å‰ä½¿ç”¨":"åˆ‡æ¢åˆ°æ¼”ç¤ºæ•°æ®"})]}),e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:"ğŸ“‹"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-feishu-primary",children:"é£ä¹¦å¤šç»´è¡¨æ ¼"}),e.jsx("p",{className:"text-sm text-feishu-secondary",children:"è¿æ¥çœŸå®çš„ä¸šåŠ¡æ•°æ®"})]})]})})]})]}),e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-feishu-primary",children:"å¤šç»´è¡¨æ ¼é…ç½®"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-feishu-primary mb-1",children:"åº”ç”¨ Token (App Token)"}),e.jsx("input",{type:"text",value:o.appToken,onChange:g=>c({...o,appToken:g.target.value}),placeholder:"bascnCMII2ORuAUfTm9IZjXMEuD",className:"w-full px-3 py-2 border border-feishu-border rounded-md focus:outline-none focus:ring-2 focus:ring-feishu-accent focus:border-transparent",required:!0}),e.jsxs("p",{className:"text-xs text-feishu-secondary mt-1",children:["ä»å¤šç»´è¡¨æ ¼ URL ä¸­è·å–ï¼Œæ ¼å¼å¦‚ï¼šhttps://example.feishu.cn/base/",e.jsx("strong",{children:"bascnCMII2ORuAUfTm9IZjXMEuD"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-feishu-primary mb-1",children:"è¡¨æ ¼ ID (Table ID)"}),e.jsx("input",{type:"text",value:o.tableId,onChange:g=>c({...o,tableId:g.target.value}),placeholder:"tblxI2tWaxP5dG7p",className:"w-full px-3 py-2 border border-feishu-border rounded-md focus:outline-none focus:ring-2 focus:ring-feishu-accent focus:border-transparent",required:!0}),e.jsx("p",{className:"text-xs text-feishu-secondary mt-1",children:"ä»è¡¨æ ¼ URL ä¸­è·å–ï¼Œæˆ–åœ¨è¡¨æ ¼è®¾ç½®ä¸­æŸ¥çœ‹"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-feishu-primary mb-1",children:"è®¿é—®ä»¤ç‰Œ (Access Token)"}),e.jsx("input",{type:"password",value:o.accessToken,onChange:g=>c({...o,accessToken:g.target.value}),placeholder:"è¯·è¾“å…¥è®¿é—®ä»¤ç‰Œ",className:"w-full px-3 py-2 border border-feishu-border rounded-md focus:outline-none focus:ring-2 focus:ring-feishu-accent focus:border-transparent",required:!0}),e.jsx("p",{className:"text-xs text-feishu-secondary mt-1",children:"é€šè¿‡é£ä¹¦å¼€æ”¾å¹³å°è·å–çš„è®¿é—®ä»¤ç‰Œ"})]})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-green-800 mb-2",children:"âœ… å·²é€‚é…ä½ çš„å­—æ®µç»“æ„"}),e.jsxs("div",{className:"text-sm text-green-700 space-y-1",children:[e.jsxs("div",{children:["â€¢ ",e.jsx("strong",{children:"æœºæ„åç§°"}),": âœ… å®Œå…¨åŒ¹é…"]}),e.jsxs("div",{children:["â€¢ ",e.jsx("strong",{children:"æ‰€å±çœä»½"}),": âœ… å®Œå…¨åŒ¹é…"]}),e.jsxs("div",{children:["â€¢ ",e.jsx("strong",{children:"æ‰€å±åŒºåŸŸ"}),": âœ… æ˜ å°„ä¸ºç®¡ç†åŒºåŸŸ"]}),e.jsxs("div",{children:["â€¢ ",e.jsx("strong",{children:"ç®¡ç†äºº"}),": âœ… æ˜ å°„ä¸ºè´Ÿè´£äºº"]}),e.jsxs("div",{children:["â€¢ ",e.jsx("strong",{children:"æœºæ„åœ°å€"}),": ğŸ”§ è‡ªåŠ¨ç”Ÿæˆï¼ˆçœä»½+åœ°åŒºï¼‰"]}),e.jsxs("div",{children:["â€¢ ",e.jsx("strong",{children:"è”ç³»æ–¹å¼"}),": ğŸ”§ ä½¿ç”¨é»˜è®¤å€¼"]}),e.jsxs("div",{children:["â€¢ ",e.jsx("strong",{children:"æˆç«‹æ—¥æœŸ"}),": ğŸ”§ ä½¿ç”¨é»˜è®¤å€¼"]}),e.jsxs("div",{children:["â€¢ ",e.jsx("strong",{children:"çŠ¶æ€"}),": ğŸ”§ é»˜è®¤ä¸ºæ´»è·ƒ"]})]}),e.jsx("div",{className:"mt-2 text-xs text-green-600",children:"ğŸ‰ ä½ çš„å¤šç»´è¡¨æ ¼å·²å®Œç¾é€‚é…ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"submit",disabled:l,className:"flex-1 feishu-button feishu-button-primary",children:l?"è¿æ¥ä¸­...":"è¿æ¥å¤šç»´è¡¨æ ¼"}),e.jsx("button",{type:"button",onClick:t,className:"feishu-button feishu-button-secondary",children:"å–æ¶ˆ"})]})]})]})})]})})},Z=["åŒ—äº¬å¸‚","ä¸Šæµ·å¸‚","å¤©æ´¥å¸‚","é‡åº†å¸‚","æ²³åŒ—çœ","å±±è¥¿çœ","è¾½å®çœ","å‰æ—çœ","é»‘é¾™æ±Ÿçœ","æ±Ÿè‹çœ","æµ™æ±Ÿçœ","å®‰å¾½çœ","ç¦å»ºçœ","æ±Ÿè¥¿çœ","å±±ä¸œçœ","æ²³å—çœ","æ¹–åŒ—çœ","æ¹–å—çœ","å¹¿ä¸œçœ","æµ·å—çœ","å››å·çœ","è´µå·çœ","äº‘å—çœ","é™•è¥¿çœ","ç”˜è‚ƒçœ","é’æµ·çœ","å°æ¹¾çœ","å†…è’™å¤è‡ªæ²»åŒº","å¹¿è¥¿å£®æ—è‡ªæ²»åŒº","è¥¿è—è‡ªæ²»åŒº","å®å¤å›æ—è‡ªæ²»åŒº","æ–°ç–†ç»´å¾å°”è‡ªæ²»åŒº","é¦™æ¸¯ç‰¹åˆ«è¡Œæ”¿åŒº","æ¾³é—¨ç‰¹åˆ«è¡Œæ”¿åŒº"],q={åä¸œ:["ä¸Šæµ·å¸‚","æ±Ÿè‹çœ","æµ™æ±Ÿçœ","å®‰å¾½çœ","ç¦å»ºçœ","æ±Ÿè¥¿çœ","å±±ä¸œçœ"],åå—:["å¹¿ä¸œçœ","å¹¿è¥¿å£®æ—è‡ªæ²»åŒº","æµ·å—çœ","é¦™æ¸¯ç‰¹åˆ«è¡Œæ”¿åŒº","æ¾³é—¨ç‰¹åˆ«è¡Œæ”¿åŒº"],åè¥¿:["å››å·çœ","è´µå·çœ","äº‘å—çœ","è¥¿è—è‡ªæ²»åŒº"],ååŒ—:["åŒ—äº¬å¸‚","å¤©æ´¥å¸‚","æ²³åŒ—çœ","å±±è¥¿çœ","å†…è’™å¤è‡ªæ²»åŒº"],åä¸­:["æ²³å—çœ","æ¹–åŒ—çœ","æ¹–å—çœ"],ä¸œåŒ—:["è¾½å®çœ","å‰æ—çœ","é»‘é¾™æ±Ÿçœ"],è¥¿åŒ—:["é™•è¥¿çœ","ç”˜è‚ƒçœ","é’æµ·çœ","å®å¤å›æ—è‡ªæ²»åŒº","æ–°ç–†ç»´å¾å°”è‡ªæ²»åŒº"],å…¶ä»–:["å°æ¹¾çœ"]},yt=({isOpen:s,onClose:t})=>{const{regionMapping:n,setRegionMapping:a}=S(),[r,i]=N.useState(n||q),[o,c]=N.useState("");if(!s)return null;const l=Object.values(r).flat(),h=Z.filter(u=>!l.includes(u)),d=()=>{o.trim()&&!r[o.trim()]&&(i({...r,[o.trim()]:[]}),c(""))},m=u=>{const x={...r};delete x[u],i(x)},g=(u,x)=>{const p={...r};Object.keys(p).forEach(j=>{p[j]=p[j].filter(D=>D!==x)}),p[u]=[...p[u],x],i(p)},b=(u,x)=>{i({...r,[u]:r[u].filter(p=>p!==x)})},v=()=>{a(r),t()},f=()=>{i(q)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-feishu-primary",children:"ç®¡ç†åŒºåŸŸé…ç½®"}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 text-2xl font-bold",children:"Ã—"})]}),e.jsx("p",{className:"text-sm text-feishu-secondary mt-1",children:"è‡ªå®šä¹‰çœä»½ä¸ç®¡ç†åŒºåŸŸçš„å¯¹åº”å…³ç³»ï¼Œæ¯ä¸ªçœä»½åªèƒ½å±äºä¸€ä¸ªç®¡ç†åŒºåŸŸ"})]}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[70vh]",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-feishu-primary",children:"ç®¡ç†åŒºåŸŸ"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"text",value:o,onChange:u=>c(u.target.value),placeholder:"è¾“å…¥æ–°åŒºåŸŸåç§°",className:"px-3 py-1 border border-feishu-border rounded text-sm",onKeyPress:u=>u.key==="Enter"&&d()}),e.jsx("button",{onClick:d,className:"feishu-button feishu-button-primary text-sm",disabled:!o.trim(),children:"æ·»åŠ åŒºåŸŸ"})]})]}),e.jsx("div",{className:"space-y-3",children:Object.entries(r).map(([u,x])=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"font-medium text-feishu-primary flex items-center",children:[e.jsx("div",{className:"w-4 h-4 rounded mr-2",style:{backgroundColor:jt(u)}}),u," (",x.length,"ä¸ªçœä»½)"]}),e.jsx("button",{onClick:()=>m(u),className:"text-red-500 hover:text-red-700 text-sm",children:"åˆ é™¤åŒºåŸŸ"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[x.map(p=>e.jsxs("div",{className:"flex items-center bg-gray-100 rounded-full px-3 py-1 text-sm",children:[e.jsx("span",{children:p}),e.jsx("button",{onClick:()=>b(u,p),className:"ml-2 text-gray-500 hover:text-red-500",children:"Ã—"})]},p)),x.length===0&&e.jsx("div",{className:"text-gray-400 text-sm italic",children:"æš‚æ— çœä»½ï¼Œè¯·ä»å³ä¾§æ·»åŠ "})]})]},u))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-feishu-primary",children:["æœªåˆ†é…çœä»½ (",h.length,")"]}),e.jsxs("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:[h.map(u=>e.jsxs("div",{className:"flex items-center justify-between p-2 border border-gray-200 rounded",children:[e.jsx("span",{className:"text-sm",children:u}),e.jsxs("select",{value:"",onChange:x=>{x.target.value&&g(x.target.value,u)},className:"text-xs border border-gray-300 rounded px-2 py-1",children:[e.jsx("option",{value:"",children:"åˆ†é…åˆ°..."}),Object.keys(r).map(x=>e.jsx("option",{value:x,children:x},x))]})]},u)),h.length===0&&e.jsx("div",{className:"text-center text-gray-400 text-sm py-4",children:"æ‰€æœ‰çœä»½éƒ½å·²åˆ†é…"})]})]})]}),e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:"é…ç½®ç»Ÿè®¡"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-blue-600 font-semibold",children:Object.keys(r).length}),e.jsx("div",{className:"text-blue-800",children:"ç®¡ç†åŒºåŸŸ"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-blue-600 font-semibold",children:l.length}),e.jsx("div",{className:"text-blue-800",children:"å·²åˆ†é…çœä»½"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-blue-600 font-semibold",children:h.length}),e.jsx("div",{className:"text-blue-800",children:"æœªåˆ†é…çœä»½"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-blue-600 font-semibold",children:Z.length}),e.jsx("div",{className:"text-blue-800",children:"æ€»çœä»½æ•°"})]})]})]})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 border-t border-gray-200 flex justify-between",children:[e.jsx("button",{onClick:f,className:"feishu-button feishu-button-secondary",children:"é‡ç½®ä¸ºé»˜è®¤"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:t,className:"feishu-button feishu-button-secondary",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:v,className:"feishu-button feishu-button-primary",children:"ä¿å­˜é…ç½®"})]})]})]})})},jt=s=>({åä¸œ:"#3b82f6",åå—:"#ef4444",åè¥¿:"#22c55e",ååŒ—:"#eab308",åä¸­:"#8b5cf6",ä¸œåŒ—:"#06b6d4",è¥¿åŒ—:"#f59e0b",å…¶ä»–:"#6b7280"})[s]||"#6b7280",C=class C{constructor(){w(this,"isInitialized",!1);w(this,"onConfirmCallback");w(this,"onCancelCallback")}static getInstance(){return C.instance||(C.instance=new C),C.instance}async initialize(){if(!this.isInitialized)try{if(typeof window.h5sdk>"u"){console.warn("é£ä¹¦ SDK æœªåŠ è½½ï¼Œä½¿ç”¨æ¼”ç¤ºæ¨¡å¼"),this.initDemoMode();return}await window.h5sdk.ready();const t=await this.getPluginConfig();console.log("æ’ä»¶é…ç½®:",t),this.showActionButtons(),this.setupEventListeners(),this.isInitialized=!0,console.log("é£ä¹¦æ’ä»¶åˆå§‹åŒ–æˆåŠŸ")}catch(t){console.error("é£ä¹¦æ’ä»¶åˆå§‹åŒ–å¤±è´¥:",t),this.initDemoMode()}}initDemoMode(){console.log("å¯åŠ¨æ¼”ç¤ºæ¨¡å¼"),this.isInitialized=!0,setTimeout(()=>{this.showActionButtons()},1e3)}async getPluginConfig(){try{if(window.h5sdk&&window.h5sdk.bitable)return{data:await window.h5sdk.bitable.base.getSelection(),width:800,height:600}}catch(t){console.error("è·å–æ’ä»¶é…ç½®å¤±è´¥:",t)}return{width:800,height:600}}showActionButtons(){const t=document.getElementById("plugin-actions");t&&(t.style.display="block")}hideActionButtons(){const t=document.getElementById("plugin-actions");t&&(t.style.display="none")}setupEventListeners(){const t=document.getElementById("confirm-btn"),n=document.getElementById("cancel-btn");t&&t.addEventListener("click",()=>{this.handleConfirm()}),n&&n.addEventListener("click",()=>{this.handleCancel()})}async handleConfirm(){try{console.log("ç”¨æˆ·ç‚¹å‡»ç¡®è®¤");const t=this.getCurrentPluginData();this.onConfirmCallback&&this.onConfirmCallback(t),window.h5sdk?(await this.savePluginData(t),await window.h5sdk.bridge.close()):(this.showMessage("é…ç½®å·²ä¿å­˜ï¼ˆæ¼”ç¤ºæ¨¡å¼ï¼‰","success"),this.hideActionButtons())}catch(t){console.error("ç¡®è®¤æ“ä½œå¤±è´¥:",t),this.showMessage("ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•","error")}}async handleCancel(){try{console.log("ç”¨æˆ·ç‚¹å‡»å–æ¶ˆ"),this.onCancelCallback&&this.onCancelCallback(),window.h5sdk?await window.h5sdk.bridge.close():(this.showMessage("å·²å–æ¶ˆé…ç½®","info"),this.hideActionButtons())}catch(t){console.error("å–æ¶ˆæ“ä½œå¤±è´¥:",t)}}getCurrentPluginData(){return{timestamp:Date.now(),config:{dataSource:localStorage.getItem("feishu-map-datasource")||"demo",regionMapping:JSON.parse(localStorage.getItem("feishu-map-regions")||"{}"),colorScheme:localStorage.getItem("feishu-map-colors")||"default"}}}async savePluginData(t){if(window.h5sdk&&window.h5sdk.bitable)try{console.log("ä¿å­˜æ’ä»¶æ•°æ®:",t)}catch(n){throw console.error("ä¿å­˜æ•°æ®å¤±è´¥:",n),n}}showMessage(t,n="info"){const a=document.createElement("div");a.style.cssText=`
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 12px 24px;
      border-radius: 4px;
      color: white;
      font-size: 14px;
      z-index: 10000;
      background: ${n==="success"?"#52c41a":n==="error"?"#ff4d4f":"#1890ff"};
    `,a.textContent=t,document.body.appendChild(a),setTimeout(()=>{a.parentNode&&a.parentNode.removeChild(a)},3e3)}onConfirm(t){this.onConfirmCallback=t}onCancel(t){this.onCancelCallback=t}isInFeishuEnvironment(){return typeof window.h5sdk<"u"}async getUserInfo(){if(window.h5sdk&&window.h5sdk.bitable)try{return await window.h5sdk.bitable.bridge.getUserInfo()}catch(t){return console.error("è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:",t),null}return null}async getBitableData(){if(window.h5sdk&&window.h5sdk.bitable)try{const t=await window.h5sdk.bitable.base.getSelection();if(t&&t.tableId)return await(await window.h5sdk.bitable.base.getTableById(t.tableId)).getRecords()}catch(t){console.error("è·å–å¤šç»´è¡¨æ ¼æ•°æ®å¤±è´¥:",t)}return null}};w(C,"instance");let B=C;const k=B.getInstance(),Nt=()=>{const s=ft(),t=gt(),n=re(),{loadRegions:a,setSelectedRegion:r}=ie(),{dataSource:i}=S(),[o,c]=N.useState(!1),[l,h]=N.useState(!1);N.useEffect(()=>{(async()=>{try{if(await k.initialize(),k.onConfirm(g=>{console.log("æ’ä»¶ç¡®è®¤ï¼Œä¿å­˜æ•°æ®:",g)}),k.onCancel(()=>{console.log("æ’ä»¶å–æ¶ˆ")}),a(),k.isInFeishuEnvironment()){const g=await k.getBitableData();g&&console.log("è·å–åˆ°å¤šç»´è¡¨æ ¼æ•°æ®:",g)}}catch(g){console.error("æ’ä»¶åˆå§‹åŒ–å¤±è´¥:",g),a()}})()},[a]);const d=m=>{r(m),console.log("é€‰ä¸­åœ°åŒº:",m)};return e.jsx("div",{className:"min-h-screen bg-feishu-background",children:e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx("header",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-feishu-primary",children:"ä¸­å›½åœ°å›¾ä»ªè¡¨ç›˜"}),e.jsx("p",{className:"text-feishu-secondary mt-2 text-lg",children:"æ ¹æ®åœ°åŒºè´Ÿè´£äººæœºæ„æ•°é‡è¿›è¡Œé¢œè‰²æ ‡è®°"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-feishu-secondary",children:"æ•°æ®æº"}),e.jsx("div",{className:"font-medium text-feishu-primary",children:i==="bitable"?"é£ä¹¦å¤šç»´è¡¨æ ¼":"æ¼”ç¤ºæ•°æ®"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>h(!0),className:"feishu-button feishu-button-secondary",children:"ğŸ—ºï¸ åŒºåŸŸé…ç½®"}),e.jsx("button",{onClick:()=>c(!0),className:"feishu-button feishu-button-secondary",children:"âš™ï¸ æ•°æ®æº"})]})]})]})}),e.jsx("div",{className:"mb-6",children:e.jsx(bt,{regions:s,loading:t.isLoading,onRegionSelect:d})}),t.error&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-red-500",children:"âš ï¸"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-red-800",children:"åŠ è½½å¤±è´¥"}),e.jsx("div",{className:"text-sm text-red-600",children:t.error.message})]})]})}),!t.isLoading&&s.length>0&&n&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"feishu-card p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-feishu-accent",children:n.totalRegions}),e.jsx("div",{className:"text-feishu-secondary",children:"è¦†ç›–çœä»½"})]}),e.jsxs("div",{className:"feishu-card p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-feishu-success",children:n.totalInstitutions}),e.jsx("div",{className:"text-feishu-secondary",children:"æ€»æœºæ„æ•°"})]}),e.jsxs("div",{className:"feishu-card p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-feishu-warning",children:n.totalManagers}),e.jsx("div",{className:"text-feishu-secondary",children:"è´Ÿè´£äººæ•°"})]}),e.jsxs("div",{className:"feishu-card p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-feishu-primary",children:n.activeInstitutions}),e.jsx("div",{className:"text-feishu-secondary",children:"æ´»è·ƒæœºæ„"})]})]}),e.jsx(vt,{isOpen:o,onClose:()=>c(!1)}),e.jsx(yt,{isOpen:l,onClose:()=>h(!1)})]})})};function wt(){return e.jsx("div",{className:"min-h-screen bg-feishu-background",children:e.jsx(Nt,{})})}$.createRoot(document.getElementById("root")).render(e.jsx(X.StrictMode,{children:e.jsx(wt,{})}));
//# sourceMappingURL=index-d3d5ec2e.js.map
